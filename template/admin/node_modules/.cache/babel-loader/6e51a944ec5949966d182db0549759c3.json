{"remainingRequest":"/Volumes/mac/webwork/2023/dati/template/admin/node_modules/babel-loader/lib/index.js!/Volumes/mac/webwork/2023/dati/template/admin/src/utils/videoCloud.js","dependencies":[{"path":"/Volumes/mac/webwork/2023/dati/template/admin/src/utils/videoCloud.js","mtime":1689324015416},{"path":"/Volumes/mac/webwork/2023/dati/template/admin/babel.config.js","mtime":1689324015052},{"path":"/Volumes/mac/webwork/2023/dati/template/admin/.babelrc","mtime":1689324015050},{"path":"/Volumes/mac/webwork/2023/dati/template/admin/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Volumes/mac/webwork/2023/dati/template/admin/node_modules/babel-loader/lib/index.js","mtime":315532800000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuZnVuY3Rpb24ubmFtZS5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC50by1zdHJpbmcuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5yZWdleHAuZXhlYy5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5yZXBsYWNlLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMucmVnZXhwLnRlc3QuanMiOwovLyArLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQovLyB8IENSTUVCIFsgQ1JNRULotYvog73lvIDlj5HogIXvvIzliqnlipvkvIHkuJrlj5HlsZUgXQovLyArLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQovLyB8IENvcHlyaWdodCAoYykgMjAxNn4yMDIzIGh0dHBzOi8vd3d3LmNybWViLmNvbSBBbGwgcmlnaHRzIHJlc2VydmVkLgovLyArLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQovLyB8IExpY2Vuc2VkIENSTUVC5bm25LiN5piv6Ieq55Sx6L2v5Lu277yM5pyq57uP6K645Y+v5LiN6IO95Y675o6JQ1JNRULnm7jlhbPniYjmnYMKLy8gKy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KLy8gfCBBdXRob3I6IENSTUVCIFRlYW0gPGFkbWluQGNybWViLmNvbT4KLy8gKy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCmltcG9ydCAqIGFzIHFpbml1IGZyb20gJ3Fpbml1LWpzJzsKaW1wb3J0IENvcyBmcm9tICdjb3MtanMtc2RrLXY1JzsKaW1wb3J0IGF4aW9zIGZyb20gJ2F4aW9zJzsKZXhwb3J0IGRlZmF1bHQgewogIHZpZGVvVXBsb2FkOiBmdW5jdGlvbiB2aWRlb1VwbG9hZChjb25maWcpIHsKICAgIGlmIChjb25maWcudHlwZSA9PT0gJ0NPUycpIHsKICAgICAgcmV0dXJuIHRoaXMuY29zVXBsb2FkKGNvbmZpZy5ldmZpbGUsIGNvbmZpZy5yZXMuZGF0YSwgY29uZmlnLnVwbG9hZGluZyk7CiAgICB9IGVsc2UgaWYgKGNvbmZpZy50eXBlID09PSAnT1NTJykgewogICAgICByZXR1cm4gdGhpcy5vc3NIdHRwKGNvbmZpZy5ldmZpbGUsIGNvbmZpZy5yZXMsIGNvbmZpZy51cGxvYWRpbmcpOwogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuIHRoaXMucWluaXVIdHRwKGNvbmZpZy5ldmZpbGUsIGNvbmZpZy5yZXMsIGNvbmZpZy51cGxvYWRpbmcpOwogICAgfQogIH0sCiAgY29zVXBsb2FkOiBmdW5jdGlvbiBjb3NVcGxvYWQoZmlsZSwgY29uZmlnLCB1cGxvYWRpbmcpIHsKICAgIHZhciBjb3MgPSBuZXcgQ29zKHsKICAgICAgZ2V0QXV0aG9yaXphdGlvbjogZnVuY3Rpb24gZ2V0QXV0aG9yaXphdGlvbihvcHRpb25zLCBjYWxsYmFjaykgewogICAgICAgIGNhbGxiYWNrKHsKICAgICAgICAgIFRtcFNlY3JldElkOiBjb25maWcuY3JlZGVudGlhbHMudG1wU2VjcmV0SWQsCiAgICAgICAgICAvLyDkuLTml7blr4bpkqXnmoQgdG1wU2VjcmV0SWQKICAgICAgICAgIFRtcFNlY3JldEtleTogY29uZmlnLmNyZWRlbnRpYWxzLnRtcFNlY3JldEtleSwKICAgICAgICAgIC8vIOS4tOaXtuWvhumSpeeahCB0bXBTZWNyZXRLZXkKICAgICAgICAgIFhDb3NTZWN1cml0eVRva2VuOiBjb25maWcuY3JlZGVudGlhbHMuc2Vzc2lvblRva2VuLAogICAgICAgICAgLy8g5Li05pe25a+G6ZKl55qEIHNlc3Npb25Ub2tlbgogICAgICAgICAgRXhwaXJlZFRpbWU6IGNvbmZpZy5leHBpcmVkVGltZSAvLyDkuLTml7blr4bpkqXlpLHmlYjml7bpl7TmiLPvvIzmmK/nlLPor7fkuLTml7blr4bpkqXml7bvvIzml7bpl7TmiLPliqAgZHVyYXRpb25TZWNvbmRzCiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0pOwoKICAgIHZhciBmaWxlT2JqZWN0ID0gZmlsZS50YXJnZXQuZmlsZXNbMF07CiAgICB2YXIgS2V5ID0gZmlsZU9iamVjdC5uYW1lOwogICAgdmFyIHBvcyA9IEtleS5sYXN0SW5kZXhPZignLicpOwogICAgdmFyIHN1ZmZpeCA9ICcnOwogICAgaWYgKHBvcyAhPT0gLTEpIHsKICAgICAgc3VmZml4ID0gS2V5LnN1YnN0cmluZyhwb3MpOwogICAgfQogICAgdmFyIGZpbGVuYW1lID0gbmV3IERhdGUoKS5nZXRUaW1lKCkgKyBzdWZmaXg7CiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewogICAgICBjb3Muc2xpY2VVcGxvYWRGaWxlKHsKICAgICAgICBCdWNrZXQ6IGNvbmZpZy5idWNrZXQgLyog5b+F6aG7ICovLAogICAgICAgIFJlZ2lvbjogY29uZmlnLnJlZ2lvbiAvKiDlv4XpobsgKi8sCiAgICAgICAgS2V5OiBmaWxlbmFtZSAvKiDlv4XpobsgKi8sCiAgICAgICAgQm9keTogZmlsZU9iamVjdCwKICAgICAgICAvLyDkuIrkvKDmlofku7blr7nosaEKICAgICAgICBvblByb2dyZXNzOiBmdW5jdGlvbiBvblByb2dyZXNzKHByb2dyZXNzRGF0YSkgewogICAgICAgICAgdXBsb2FkaW5nKHByb2dyZXNzRGF0YSk7CiAgICAgICAgfQogICAgICB9LCBmdW5jdGlvbiAoZXJyLCBkYXRhKSB7CiAgICAgICAgaWYgKGVycikgewogICAgICAgICAgcmVqZWN0KHsKICAgICAgICAgICAgbXNnOiBlcnIKICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByZXNvbHZlKHsKICAgICAgICAgICAgdXJsOiAnaHR0cDovLycgKyBkYXRhLkxvY2F0aW9uLAogICAgICAgICAgICBFVGFnOiBkYXRhLkVUYWcKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9KTsKICB9LAogIGNvc0h0dHA6IGZ1bmN0aW9uIGNvc0h0dHAoZXZmaWxlLCByZXMsIHZpZGVvSW5nKSB7CiAgICAvLyDohb7orq/kupEKICAgIC8vIOWvueabtOWkmuWtl+espue8lueggeeahCB1cmwgZW5jb2RlIOagvOW8jwogICAgdmFyIGNhbVNhZmVVcmxFbmNvZGUgPSBmdW5jdGlvbiBjYW1TYWZlVXJsRW5jb2RlKHN0cikgewogICAgICByZXR1cm4gZW5jb2RlVVJJQ29tcG9uZW50KHN0cikucmVwbGFjZSgvIS9nLCAnJTIxJykucmVwbGFjZSgvJy9nLCAnJTI3JykucmVwbGFjZSgvXCgvZywgJyUyOCcpLnJlcGxhY2UoL1wpL2csICclMjknKS5yZXBsYWNlKC9cKi9nLCAnJTJBJyk7CiAgICB9OwogICAgdmFyIGZpbGVPYmplY3QgPSBldmZpbGUudGFyZ2V0LmZpbGVzWzBdOwogICAgdmFyIEtleSA9IGZpbGVPYmplY3QubmFtZTsKICAgIHZhciBwb3MgPSBLZXkubGFzdEluZGV4T2YoJy4nKTsKICAgIHZhciBzdWZmaXggPSAnJzsKICAgIGlmIChwb3MgIT09IC0xKSB7CiAgICAgIHN1ZmZpeCA9IEtleS5zdWJzdHJpbmcocG9zKTsKICAgIH0KICAgIHZhciBmaWxlbmFtZSA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpICsgc3VmZml4OwogICAgdmFyIGRhdGEgPSByZXMuZGF0YTsKICAgIHZhciBYQ29zU2VjdXJpdHlUb2tlbiA9IGRhdGEuY3JlZGVudGlhbHMuc2Vzc2lvblRva2VuOwogICAgdmFyIHVybCA9IGRhdGEudXJsICsgY2FtU2FmZVVybEVuY29kZShmaWxlbmFtZSkucmVwbGFjZSgvJTJGL2csICcvJyk7CiAgICB2YXIgeGhyID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7CiAgICB4aHIub3BlbignUFVUJywgdXJsLCB0cnVlKTsKICAgIFhDb3NTZWN1cml0eVRva2VuICYmIHhoci5zZXRSZXF1ZXN0SGVhZGVyKCd4LWNvcy1zZWN1cml0eS10b2tlbicsIFhDb3NTZWN1cml0eVRva2VuKTsKICAgIHhoci51cGxvYWQub25wcm9ncmVzcyA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHZhciBwcm9ncmVzcyA9IE1hdGgucm91bmQoZS5sb2FkZWQgLyBlLnRvdGFsICogMTAwMDApIC8gMTAwOwogICAgICB2aWRlb0luZyh0cnVlLCBwcm9ncmVzcyk7CiAgICB9OwogICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsKICAgICAgeGhyLm9ubG9hZCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICBpZiAoL14yXGRcZCQvLnRlc3QoJycgKyB4aHIuc3RhdHVzKSkgewogICAgICAgICAgdmFyIEVUYWcgPSB4aHIuZ2V0UmVzcG9uc2VIZWFkZXIoJ2V0YWcnKTsKICAgICAgICAgIHZpZGVvSW5nKGZhbHNlLCAwKTsKICAgICAgICAgIHJlc29sdmUoewogICAgICAgICAgICB1cmw6IHVybCwKICAgICAgICAgICAgRVRhZzogRVRhZwogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHJlamVjdCh7CiAgICAgICAgICAgIG1zZzogJ+aWh+S7tiAnICsgZmlsZW5hbWUgKyAnIOS4iuS8oOWksei0pe+8jOeKtuaAgeegge+8micgKyB4aHIuc3RhdHUKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfTsKICAgICAgeGhyLm9uZXJyb3IgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmVqZWN0KHsKICAgICAgICAgIG1zZzogJ+aWh+S7tiAnICsgZmlsZW5hbWUgKyAn5LiK5Lyg5aSx6LSl77yM6K+35qOA5p+l5piv5ZCm5rKh6YWN572uIENPUlMg6Leo5Z+f6KeEJwogICAgICAgIH0pOwogICAgICB9OwogICAgICB4aHIuc2VuZChmaWxlT2JqZWN0KTsKICAgICAgeGhyLm9ucmVhZHlzdGF0ZWNoYW5nZSA9IGZ1bmN0aW9uICgpIHt9OwogICAgfSk7CiAgfSwKICBvc3NIdHRwOiBmdW5jdGlvbiBvc3NIdHRwKGV2ZmlsZSwgcmVzLCB2aWRlb0luZykgewogICAgdmFyIHRoYXQgPSB0aGlzOwogICAgdmFyIGZpbGVPYmplY3QgPSBldmZpbGUudGFyZ2V0LmZpbGVzWzBdOwogICAgdmFyIGZpbGUgPSBmaWxlT2JqZWN0Lm5hbWU7CiAgICB2YXIgcG9zID0gZmlsZS5sYXN0SW5kZXhPZignLicpOwogICAgdmFyIHN1ZmZpeCA9ICcnOwogICAgaWYgKHBvcyAhPT0gLTEpIHsKICAgICAgc3VmZml4ID0gZmlsZS5zdWJzdHJpbmcocG9zKTsKICAgIH0KICAgIHZhciBmaWxlbmFtZSA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpICsgc3VmZml4OwogICAgdmFyIGZvcm1EYXRhID0gbmV3IEZvcm1EYXRhKCk7CiAgICB2YXIgZGF0YSA9IHJlcy5kYXRhOwogICAgLy8g5rOo5oSPZm9ybURhdGHph4xhcHBlbmTmt7vliqDnmoTplK7nmoTlpKflsI/lhpkKICAgIGZvcm1EYXRhLmFwcGVuZCgna2V5JywgZmlsZW5hbWUpOyAvLyDlrZjlgqjlnKhvc3PnmoTmlofku7bot6/lvoQKICAgIGZvcm1EYXRhLmFwcGVuZCgnT1NTQWNjZXNzS2V5SWQnLCBkYXRhLmFjY2Vzc2lkKTsgLy8gYWNjZXNzS2V5SWQKICAgIGZvcm1EYXRhLmFwcGVuZCgncG9saWN5JywgZGF0YS5wb2xpY3kpOyAvLyBwb2xpY3kKICAgIGZvcm1EYXRhLmFwcGVuZCgnU2lnbmF0dXJlJywgZGF0YS5zaWduYXR1cmUpOyAvLyDnrb7lkI0KICAgIC8vIOWmguaenOaYr2Jhc2U2NOaWh+S7tu+8jOmCo+S5iOebtOaOpeaKimJhc2U2NOWtl+espuS4sui9rOaIkGJsb2Llr7nosaHov5vooYzkuIrkvKDlsLHlj6/ku6XkuoYKICAgIGZvcm1EYXRhLmFwcGVuZCgnZmlsZScsIGZpbGVPYmplY3QpOwogICAgZm9ybURhdGEuYXBwZW5kKCdzdWNjZXNzX2FjdGlvbl9zdGF0dXMnLCAyMDApOyAvLyDmiJDlip/lkI7ov5Tlm57nmoTmk43kvZznoIEKICAgIHZhciB1cmwgPSBkYXRhLmhvc3Q7CiAgICB2YXIgZmlsZVVybCA9IHVybCArICcvJyArIGZpbGVuYW1lOwogICAgdmlkZW9JbmcodHJ1ZSwgMTAwKTsKICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7CiAgICAgIGF4aW9zLmRlZmF1bHRzLndpdGhDcmVkZW50aWFscyA9IGZhbHNlOwogICAgICBheGlvcy5wb3N0KHVybCwgZm9ybURhdGEpLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgIC8vIHRoYXQucHJvZ3Jlc3MgPSAwOwogICAgICAgIHZpZGVvSW5nKGZhbHNlLCAwKTsKICAgICAgICByZXNvbHZlKHsKICAgICAgICAgIHVybDogZmlsZVVybAogICAgICAgIH0pOwogICAgICB9KS5jYXRjaChmdW5jdGlvbiAocmVzKSB7CiAgICAgICAgcmVqZWN0KHsKICAgICAgICAgIG1zZzogcmVzCiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfSk7CiAgfSwKICBxaW5pdUh0dHA6IGZ1bmN0aW9uIHFpbml1SHR0cChldmZpbGUsIHJlcywgdmlkZW9JbmcpIHsKICAgIHZhciB1cHRva2VuID0gcmVzLmRhdGEudG9rZW47CiAgICB2YXIgZmlsZSA9IGV2ZmlsZS50YXJnZXQuZmlsZXNbMF07IC8vIEJsb2Ig5a+56LGh77yM5LiK5Lyg55qE5paH5Lu2CiAgICB2YXIgS2V5ID0gZmlsZS5uYW1lOyAvLyDkuIrkvKDlkI7mlofku7botYTmupDlkI3ku6Xorr7nva7nmoQga2V5IOS4uuS4u++8jOWmguaenCBrZXkg5Li6IG51bGwg5oiW6ICFIHVuZGVmaW5lZO+8jOWImeaWh+S7tui1hOa6kOWQjeS8muS7pSBoYXNoIOWAvOS9nOS4uui1hOa6kOWQjeOAggogICAgdmFyIHBvcyA9IEtleS5sYXN0SW5kZXhPZignLicpOwogICAgdmFyIHN1ZmZpeCA9ICcnOwogICAgaWYgKHBvcyAhPT0gLTEpIHsKICAgICAgc3VmZml4ID0gS2V5LnN1YnN0cmluZyhwb3MpOwogICAgfQogICAgdmFyIGZpbGVuYW1lID0gbmV3IERhdGUoKS5nZXRUaW1lKCkgKyBzdWZmaXg7CiAgICB2YXIgZmlsZVVybCA9IHJlcy5kYXRhLmRvbWFpbiArICcvJyArIGZpbGVuYW1lOwogICAgdmFyIGNvbmZpZyA9IHsKICAgICAgdXNlQ2RuRG9tYWluOiB0cnVlCiAgICB9OwogICAgdmFyIHB1dEV4dHJhID0gewogICAgICBmbmFtZTogJycsCiAgICAgIC8vIOaWh+S7tuWOn+aWh+S7tuWQjQogICAgICBwYXJhbXM6IHt9LAogICAgICAvLyDnlKjmnaXmlL7nva7oh6rlrprkuYnlj5jph48KICAgICAgbWltZVR5cGU6IG51bGwgLy8g55So5p2l6ZmQ5Yi25LiK5Lyg5paH5Lu257G75Z6L77yM5Li6IG51bGwg5pe26KGo56S65LiN5a+55paH5Lu257G75Z6L6ZmQ5Yi277yb6ZmQ5Yi257G75Z6L5pS+5Yiw5pWw57uE6YeM77yaIFsiaW1hZ2UvcG5nIiwgImltYWdlL2pwZWciLCAiaW1hZ2UvZ2lmIl0KICAgIH07CgogICAgdmFyIG9ic2VydmFibGUgPSBxaW5pdS51cGxvYWQoZmlsZSwgZmlsZW5hbWUsIHVwdG9rZW4sIHB1dEV4dHJhLCBjb25maWcpOwogICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsKICAgICAgb2JzZXJ2YWJsZS5zdWJzY3JpYmUoewogICAgICAgIG5leHQ6IGZ1bmN0aW9uIG5leHQocmVzdWx0KSB7CiAgICAgICAgICB2YXIgcHJvZ3Jlc3MgPSBNYXRoLnJvdW5kKHJlc3VsdC50b3RhbC5sb2FkZWQgLyByZXN1bHQudG90YWwuc2l6ZSk7CiAgICAgICAgICB2aWRlb0luZyh0cnVlLCBwcm9ncmVzcyk7CiAgICAgICAgICAvLyDkuLvopoHnlKjmnaXlsZXnpLrov5vluqYKICAgICAgICB9LAoKICAgICAgICBlcnJvcjogZnVuY3Rpb24gZXJyb3IoZXJyUmVzdWx0KSB7CiAgICAgICAgICAvLyDlpLHotKXmiqXplJnkv6Hmga8KICAgICAgICAgIHJlamVjdCh7CiAgICAgICAgICAgIG1zZzogZXJyUmVzdWx0CiAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIGNvbXBsZXRlOiBmdW5jdGlvbiBjb21wbGV0ZShyZXN1bHQpIHsKICAgICAgICAgIC8vIOaOpeaUtuaIkOWKn+WQjui/lOWbnueahOS/oeaBrwogICAgICAgICAgdmlkZW9JbmcoZmFsc2UsIDApOwogICAgICAgICAgcmVzb2x2ZSh7CiAgICAgICAgICAgIHVybDogZmlsZVVybAogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0pOwogIH0KfTs="},{"version":3,"names":["qiniu","Cos","axios","videoUpload","config","type","cosUpload","evfile","res","data","uploading","ossHttp","qiniuHttp","file","cos","getAuthorization","options","callback","TmpSecretId","credentials","tmpSecretId","TmpSecretKey","tmpSecretKey","XCosSecurityToken","sessionToken","ExpiredTime","expiredTime","fileObject","target","files","Key","name","pos","lastIndexOf","suffix","substring","filename","Date","getTime","Promise","resolve","reject","sliceUploadFile","Bucket","bucket","Region","region","Body","onProgress","progressData","err","msg","url","Location","ETag","cosHttp","videoIng","camSafeUrlEncode","str","encodeURIComponent","replace","xhr","XMLHttpRequest","open","setRequestHeader","upload","onprogress","e","progress","Math","round","loaded","total","onload","test","status","getResponseHeader","statu","onerror","send","onreadystatechange","that","formData","FormData","append","accessid","policy","signature","host","fileUrl","defaults","withCredentials","post","then","catch","uptoken","token","domain","useCdnDomain","putExtra","fname","params","mimeType","observable","subscribe","next","result","size","error","errResult","complete"],"sources":["/Volumes/mac/webwork/2023/dati/template/admin/src/utils/videoCloud.js"],"sourcesContent":["// +----------------------------------------------------------------------\n// | CRMEB [ CRMEB赋能开发者，助力企业发展 ]\n// +----------------------------------------------------------------------\n// | Copyright (c) 2016~2023 https://www.crmeb.com All rights reserved.\n// +----------------------------------------------------------------------\n// | Licensed CRMEB并不是自由软件，未经许可不能去掉CRMEB相关版权\n// +----------------------------------------------------------------------\n// | Author: CRMEB Team <admin@crmeb.com>\n// +----------------------------------------------------------------------\n\nimport * as qiniu from 'qiniu-js';\nimport Cos from 'cos-js-sdk-v5';\nimport axios from 'axios';\n\nexport default {\n  videoUpload(config) {\n    if (config.type === 'COS') {\n      return this.cosUpload(config.evfile, config.res.data, config.uploading);\n    } else if (config.type === 'OSS') {\n      return this.ossHttp(config.evfile, config.res, config.uploading);\n    } else {\n      return this.qiniuHttp(config.evfile, config.res, config.uploading);\n    }\n  },\n  cosUpload(file, config, uploading) {\n    let cos = new Cos({\n      getAuthorization(options, callback) {\n        callback({\n          TmpSecretId: config.credentials.tmpSecretId, // 临时密钥的 tmpSecretId\n          TmpSecretKey: config.credentials.tmpSecretKey, // 临时密钥的 tmpSecretKey\n          XCosSecurityToken: config.credentials.sessionToken, // 临时密钥的 sessionToken\n          ExpiredTime: config.expiredTime, // 临时密钥失效时间戳，是申请临时密钥时，时间戳加 durationSeconds\n        });\n      },\n    });\n    let fileObject = file.target.files[0];\n    let Key = fileObject.name;\n    let pos = Key.lastIndexOf('.');\n    let suffix = '';\n    if (pos !== -1) {\n      suffix = Key.substring(pos);\n    }\n    let filename = new Date().getTime() + suffix;\n    return new Promise((resolve, reject) => {\n      cos.sliceUploadFile(\n        {\n          Bucket: config.bucket /* 必须 */,\n          Region: config.region /* 必须 */,\n          Key: filename /* 必须 */,\n          Body: fileObject, // 上传文件对象\n          onProgress: function (progressData) {\n            uploading(progressData);\n          },\n        },\n        function (err, data) {\n          if (err) {\n            reject({ msg: err });\n          } else {\n            resolve({ url: 'http://' + data.Location, ETag: data.ETag });\n          }\n        },\n      );\n    });\n  },\n  cosHttp(evfile, res, videoIng) {\n    // 腾讯云\n    // 对更多字符编码的 url encode 格式\n    let camSafeUrlEncode = function (str) {\n      return encodeURIComponent(str)\n        .replace(/!/g, '%21')\n        .replace(/'/g, '%27')\n        .replace(/\\(/g, '%28')\n        .replace(/\\)/g, '%29')\n        .replace(/\\*/g, '%2A');\n    };\n    let fileObject = evfile.target.files[0];\n    let Key = fileObject.name;\n    let pos = Key.lastIndexOf('.');\n    let suffix = '';\n    if (pos !== -1) {\n      suffix = Key.substring(pos);\n    }\n    let filename = new Date().getTime() + suffix;\n    let data = res.data;\n    let XCosSecurityToken = data.credentials.sessionToken;\n    let url = data.url + camSafeUrlEncode(filename).replace(/%2F/g, '/');\n    let xhr = new XMLHttpRequest();\n    xhr.open('PUT', url, true);\n    XCosSecurityToken && xhr.setRequestHeader('x-cos-security-token', XCosSecurityToken);\n    xhr.upload.onprogress = function (e) {\n      let progress = Math.round((e.loaded / e.total) * 10000) / 100;\n      videoIng(true, progress);\n    };\n    return new Promise((resolve, reject) => {\n      xhr.onload = function () {\n        if (/^2\\d\\d$/.test('' + xhr.status)) {\n          var ETag = xhr.getResponseHeader('etag');\n          videoIng(false, 0);\n          resolve({ url: url, ETag: ETag });\n        } else {\n          reject({ msg: '文件 ' + filename + ' 上传失败，状态码：' + xhr.statu });\n        }\n      };\n      xhr.onerror = function () {\n        reject({ msg: '文件 ' + filename + '上传失败，请检查是否没配置 CORS 跨域规' });\n      };\n      xhr.send(fileObject);\n      xhr.onreadystatechange = function () {};\n    });\n  },\n  ossHttp(evfile, res, videoIng) {\n    let that = this;\n    let fileObject = evfile.target.files[0];\n    let file = fileObject.name;\n    let pos = file.lastIndexOf('.');\n    let suffix = '';\n    if (pos !== -1) {\n      suffix = file.substring(pos);\n    }\n    let filename = new Date().getTime() + suffix;\n    let formData = new FormData();\n    let data = res.data;\n    // 注意formData里append添加的键的大小写\n    formData.append('key', filename); // 存储在oss的文件路径\n    formData.append('OSSAccessKeyId', data.accessid); // accessKeyId\n    formData.append('policy', data.policy); // policy\n    formData.append('Signature', data.signature); // 签名\n    // 如果是base64文件，那么直接把base64字符串转成blob对象进行上传就可以了\n    formData.append('file', fileObject);\n    formData.append('success_action_status', 200); // 成功后返回的操作码\n    let url = data.host;\n    let fileUrl = url + '/' + filename;\n    videoIng(true, 100);\n    return new Promise((resolve, reject) => {\n      axios.defaults.withCredentials = false;\n      axios\n        .post(url, formData)\n        .then(() => {\n          // that.progress = 0;\n          videoIng(false, 0);\n          resolve({ url: fileUrl });\n        })\n        .catch((res) => {\n          reject({ msg: res });\n        });\n    });\n  },\n  qiniuHttp(evfile, res, videoIng) {\n    let uptoken = res.data.token;\n    let file = evfile.target.files[0]; // Blob 对象，上传的文件\n    let Key = file.name; // 上传后文件资源名以设置的 key 为主，如果 key 为 null 或者 undefined，则文件资源名会以 hash 值作为资源名。\n    let pos = Key.lastIndexOf('.');\n    let suffix = '';\n    if (pos !== -1) {\n      suffix = Key.substring(pos);\n    }\n    let filename = new Date().getTime() + suffix;\n    let fileUrl = res.data.domain + '/' + filename;\n    let config = {\n      useCdnDomain: true,\n    };\n    let putExtra = {\n      fname: '', // 文件原文件名\n      params: {}, // 用来放置自定义变量\n      mimeType: null, // 用来限制上传文件类型，为 null 时表示不对文件类型限制；限制类型放到数组里： [\"image/png\", \"image/jpeg\", \"image/gif\"]\n    };\n    let observable = qiniu.upload(file, filename, uptoken, putExtra, config);\n    return new Promise((resolve, reject) => {\n      observable.subscribe({\n        next: (result) => {\n          let progress = Math.round(result.total.loaded / result.total.size);\n          videoIng(true, progress);\n          // 主要用来展示进度\n        },\n        error: (errResult) => {\n          // 失败报错信息\n          reject({ msg: errResult });\n        },\n        complete: (result) => {\n          // 接收成功后返回的信息\n          videoIng(false, 0);\n          resolve({ url: fileUrl });\n        },\n      });\n    });\n  },\n};\n"],"mappings":"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"}]}