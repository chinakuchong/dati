{"remainingRequest":"/Volumes/mac/webwork/2023/dati/template/admin/node_modules/vue-loader/lib/index.js??vue-loader-options!/Volumes/mac/webwork/2023/dati/template/admin/node_modules/iview-loader/index.js??ref--0-2!/Volumes/mac/webwork/2023/dati/template/admin/src/pages/kefu/pc/components/delivery.vue?vue&type=style&index=0&id=40ab68fa&lang=stylus&scoped=true&","dependencies":[{"path":"/Volumes/mac/webwork/2023/dati/template/admin/src/pages/kefu/pc/components/delivery.vue","mtime":1689324015215},{"path":"/Volumes/mac/webwork/2023/dati/template/admin/node_modules/@vue/cli-service/node_modules/css-loader/index.js","mtime":499162500000},{"path":"/Volumes/mac/webwork/2023/dati/template/admin/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/Volumes/mac/webwork/2023/dati/template/admin/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/Volumes/mac/webwork/2023/dati/template/admin/node_modules/stylus-loader/index.js","mtime":1519606876000},{"path":"/Volumes/mac/webwork/2023/dati/template/admin/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Volumes/mac/webwork/2023/dati/template/admin/node_modules/vue-loader/lib/index.js","mtime":499162500000},{"path":"/Volumes/mac/webwork/2023/dati/template/admin/node_modules/iview-loader/index.js","mtime":1570440814000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCi5mb3JtLWl0ZW0KICAgIHdpZHRoIDEwMCUK"},{"version":3,"sources":["delivery.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAsTA;AACA","file":"delivery.vue","sourceRoot":"src/pages/kefu/pc/components","sourcesContent":["<template>\n  <div>\n    <Form ref=\"formValidate\" :model=\"formValidate\" :rules=\"ruleInline\" inline>\n      <FormItem label=\"选择类型：\" class=\"form-item\" label-position=\"right\" :label-width=\"100\">\n        <RadioGroup v-model=\"formValidate.gender\">\n          <Radio :label=\"item.key\" v-for=\"(item, index) in radioList\" :key=\"index\">{{ item.title }}</Radio>\n        </RadioGroup>\n      </FormItem>\n      <FormItem\n        v-if=\"formValidate.gender == 1\"\n        label=\"发货类型：\"\n        class=\"form-item\"\n        label-position=\"right\"\n        :label-width=\"100\"\n        :key=\"'test0'\"\n      >\n        <RadioGroup v-model=\"formValidate.shipStatus\">\n          <Radio :label=\"item.key\" v-for=\"(item, index) in shipType\" :key=\"index\">{{ item.title }}</Radio>\n        </RadioGroup>\n      </FormItem>\n      <!--  发货手动填写  -->\n      <div v-if=\"formValidate.gender == 1 && formValidate.shipStatus == 1\" :key=\"'test1'\">\n        <FormItem label=\"快递公司：\" prop=\"logisticsCode\" class=\"form-item\" label-position=\"right\" :label-width=\"100\">\n          <Select\n            v-model=\"formValidate.logisticsCode\"\n            filterable\n            placeholder=\"请选择\"\n            @on-change=\"bindChange\"\n            :label-in-value=\"true\"\n            style=\"width: 100%\"\n          >\n            <Option :value=\"item.code\" v-for=\"(item, index) in logisticsList\" :key=\"index\">{{ item.value }}</Option>\n          </Select>\n        </FormItem>\n        <FormItem label=\"快递单号：\" prop=\"number\" class=\"form-item\" label-position=\"right\" :label-width=\"100\">\n          <Input v-model=\"formValidate.number\" placeholder=\"请输入快递单号\" style=\"width: 100%\"></Input>\n        </FormItem>\n        <FormItem label=\"\" class=\"form-item\" label-position=\"right\" :label-width=\"100\">\n          <div style=\"color: #c4c4c4\">顺丰请输入单号：收件人或寄件人手机号后四位,</div>\n          <div style=\"color: #c4c4c4\">例如：SF000000000000:3941</div>\n        </FormItem>\n      </div>\n      <!--  电子面单打印  -->\n      <div v-if=\"formValidate.gender == 1 && formValidate.shipStatus == 2\" :key=\"'test2'\">\n        <FormItem label=\"快递公司：\" prop=\"logisticsCode\" class=\"form-item\" label-position=\"right\" :label-width=\"100\">\n          <Select\n            v-model=\"formValidate.logisticsCode\"\n            placeholder=\"请选择\"\n            style=\"width: 100%\"\n            @on-change=\"bindChange\"\n            filterable\n            :label-in-value=\"true\"\n          >\n            <Option :value=\"item.code\" v-for=\"(item, index) in logisticsList\" :key=\"index\">{{ item.value }}</Option>\n          </Select>\n        </FormItem>\n        <FormItem\n          label=\"电子面单：\"\n          class=\"form-item\"\n          label-position=\"right\"\n          :label-width=\"100\"\n          v-if=\"orderTempList.length > 0\"\n        >\n          <Select v-model=\"formValidate.electronic\" placeholder=\"请选择电子面单\" style=\"width: 80%\">\n            <Option :value=\"item.temp_id\" v-for=\"(item, index) in orderTempList\" :key=\"index\">{{ item.title }}</Option>\n          </Select>\n          <Button style=\"flex: 1; margin-left: 21px\" @click=\"lookImg\">预览</Button>\n          <viewer :images=\"orderTempList\" class=\"viewer\" ref=\"viewer\" @inited=\"inited\" style=\"display: none\">\n            <img v-for=\"src in orderTempList\" :src=\"src.pic\" :key=\"src.id\" class=\"image\" />\n          </viewer>\n        </FormItem>\n        <FormItem label=\"寄件人姓名：\" prop=\"sendName\" class=\"form-item\" label-position=\"right\" :label-width=\"100\">\n          <Input v-model=\"formValidate.sendName\" placeholder=\"请输入寄件人姓名\" style=\"width: 100%\"></Input>\n        </FormItem>\n        <FormItem label=\"寄件人电话：\" prop=\"sendPhone\" class=\"form-item\" label-position=\"right\" :label-width=\"100\">\n          <Input v-model=\"formValidate.sendPhone\" placeholder=\"请输入寄件人电话\" style=\"width: 100%\"></Input>\n        </FormItem>\n        <FormItem label=\"寄件人地址：\" prop=\"sendAddress\" class=\"form-item\" label-position=\"right\" :label-width=\"100\">\n          <Input v-model=\"formValidate.sendAddress\" placeholder=\"请输入寄件人地址\" style=\"width: 100%\"></Input>\n        </FormItem>\n      </div>\n      <!--  送货  -->\n      <div v-if=\"formValidate.gender == 2\" :key=\"'test3'\">\n        <FormItem label=\"选择送货人：\" class=\"form-item\" label-position=\"right\" :label-width=\"100\">\n          <Select v-model=\"formValidate.postPeople\" placeholder=\"选择送货人\" style=\"width: 100%\">\n            <Option :value=\"item.id\" v-for=\"(item, index) in deliveryList\" :key=\"index\">{{ item.nickname }}</Option>\n          </Select>\n        </FormItem>\n      </div>\n      <div v-if=\"formValidate.gender == 3\">\n        <FormItem label=\"备注：\" props=\"msg\" class=\"form-item\" label-position=\"right\" :label-width=\"100\">\n          <Input placeholder=\"备注\" v-model=\"formValidate.msg\" />\n        </FormItem>\n      </div>\n      <div class=\"mask-footer\">\n        <Button type=\"primary\" @click=\"handleSubmit('formValidate')\">提交</Button>\n        <Button @click=\"close\">取消</Button>\n      </div>\n    </Form>\n  </div>\n</template>\n\n<script>\nimport { orderExport, orderTemp, orderDeliveryAll, orderDelivery, getSender } from '@/api/kefu';\nexport default {\n  name: 'delivery',\n  props: {\n    isShow: {\n      type: Boolean,\n      default: false,\n    },\n    orderId: {\n      type: String | Number,\n      default: '',\n    },\n  },\n  watch: {\n    'formValidate.shipStatus': {\n      handler(nVal, oVal) {\n        if (nVal == 2 && !this.formValidate.sendName) {\n          getSender().then((res) => {\n            this.formValidate.sendName = res.data.to_name;\n            this.formValidate.sendPhone = res.data.to_tel;\n            this.formValidate.sendAddress = res.data.to_add;\n          });\n        }\n        this.$refs['formValidate'].resetFields();\n      },\n      deep: true,\n    },\n    'formValidate.gender': {\n      handler(nVal, oVal) {\n        this.$refs['formValidate'].resetFields();\n      },\n      deep: true,\n    },\n  },\n  data() {\n    return {\n      shipType: [\n        {\n          key: 1,\n          title: '手动填写',\n        },\n        {\n          key: 2,\n          title: '电子面单打印',\n        },\n      ],\n      radioList: [\n        {\n          key: 1,\n          title: '发货',\n        },\n        {\n          key: 2,\n          title: '送货',\n        },\n        {\n          key: 3,\n          title: '虚拟',\n        },\n      ],\n      ruleInline: {\n        logisticsCode: [{ required: true, message: '请选择快递公司', trigger: 'change' }],\n        number: [{ required: true, message: '请填写快递单号', trigger: 'change' }],\n        sendName: [{ required: true, message: '请填写寄件人姓名', trigger: 'change' }],\n        sendPhone: [\n          { required: true, message: '请填写寄件人手机', trigger: 'change' },\n          { pattern: /^1[3456789]\\d{9}$/, message: '手机号码格式不正确', trigger: 'blur' },\n        ],\n        sendAddress: [{ required: true, message: '请填写寄件人地址', trigger: 'change' }],\n        msg: [{ required: true, message: '请填写备注信息', trigger: 'change' }],\n      },\n      formValidate: {\n        gender: 1,\n        shipStatus: 1,\n        logisticsCode: '', // 快递公司编号\n        logisticsName: '', // 快递公司名称\n        number: '', // 快递单号\n        electronic: '', //电子面单\n        sendName: '', //寄件人姓名\n        sendPhone: '', // 寄件人电话\n        sendAddress: '', //寄件人地址\n        postPeople: '', // 配送员\n        msg: '', // 备注\n      },\n      logisticsList: [],\n      orderTempList: [],\n      deliveryList: [],\n    };\n  },\n  mounted() {\n    this.getOrderExport();\n    this.getDelivery();\n  },\n  methods: {\n    // 获取配送人\n    getDelivery() {\n      orderDeliveryAll().then((res) => {\n        this.deliveryList = res.data;\n      });\n    },\n    //查看大图\n    inited(viewer) {\n      this.$viewer = viewer;\n    },\n    //物流公司\n    getOrderExport() {\n      orderExport().then((res) => {\n        this.logisticsList = res.data;\n      });\n    },\n    handleSubmit(name) {\n      if (this.formValidate.gender == 1) {\n        this.$refs[name].validate((valid) => {\n          let paramsData = {};\n          paramsData.type = this.formValidate.gender;\n          paramsData.express_record_type = parseFloat(this.formValidate.shipStatus);\n          paramsData.delivery_name = this.formValidate.logisticsName;\n          paramsData.delivery_code = this.formValidate.logisticsCode;\n          if (valid) {\n            // 手动\n            if (this.formValidate.gender == 1 && this.formValidate.shipStatus == 1) {\n              paramsData.delivery_id = this.formValidate.number;\n            }\n            // 电子\n            if (this.formValidate.gender == 1 && this.formValidate.shipStatus == 2) {\n              paramsData.to_name = this.formValidate.sendName;\n              paramsData.to_tel = this.formValidate.sendPhone;\n              paramsData.to_addr = this.formValidate.sendAddress;\n              paramsData.express_temp_id = this.formValidate.electronic;\n            }\n            orderDelivery(this.orderId, paramsData)\n              .then((res) => {\n                this.$Message.success(res.msg);\n                this.$emit('ok');\n              })\n              .catch((error) => {\n                this.$Message.error(error.msg);\n              });\n          } else {\n          }\n        });\n      }\n      if (this.formValidate.gender == 2) {\n        let people = {};\n        this.deliveryList.forEach((el, index) => {\n          if (el.id == this.formValidate.postPeople) {\n            people = el;\n          }\n        });\n        orderDelivery(this.orderId, {\n          type: this.formValidate.gender,\n          sh_delivery_name: people.wx_name,\n          sh_delivery_id: people.phone,\n          sh_delivery_uid: people.id,\n        })\n          .then((res) => {\n            this.$Message.success(res.msg);\n            this.$emit('ok');\n          })\n          .catch((error) => {\n            this.$Message.error(error.msg);\n          });\n      }\n      if (this.formValidate.gender == 3) {\n        orderDelivery(this.orderId, {\n          type: this.formValidate.gender,\n          remark: this.formValidate.msg,\n        })\n          .then((res) => {\n            this.$Message.success(res.msg);\n            this.$emit('ok');\n          })\n          .catch((error) => {\n            this.$Message.error(error.msg);\n          });\n      }\n    },\n    close() {\n      this.$emit('close');\n    },\n    // 物流选中\n    bindChange(val) {\n      this.formValidate.logisticsName = val.label;\n      if (this.formValidate.shipStatus == 2) {\n        orderTemp({\n          com: val.value,\n        }).then((res) => {\n          this.orderTempList = res.data.data;\n        });\n      }\n    },\n    lookImg() {\n      if (this.formValidate.electronic) {\n        this.orderTempList.forEach((el, index) => {\n          if (el.temp_id == this.formValidate.electronic) {\n            this.$viewer.view(index);\n          }\n        });\n      } else {\n        this.$Message.error('请选择电子面单');\n      }\n    },\n  },\n};\n</script>\n\n<style lang=\"stylus\" scoped>\n.form-item\n    width 100%\n</style>\n"]}]}