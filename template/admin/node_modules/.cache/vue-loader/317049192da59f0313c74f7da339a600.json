{"remainingRequest":"/Volumes/mac/webwork/2023/dati/template/admin/node_modules/vue-loader/lib/index.js??vue-loader-options!/Volumes/mac/webwork/2023/dati/template/admin/node_modules/iview-loader/index.js??ref--0-2!/Volumes/mac/webwork/2023/dati/template/admin/src/components/couponList/index.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Volumes/mac/webwork/2023/dati/template/admin/src/components/couponList/index.vue","mtime":1689324015140},{"path":"/Volumes/mac/webwork/2023/dati/template/admin/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Volumes/mac/webwork/2023/dati/template/admin/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Volumes/mac/webwork/2023/dati/template/admin/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Volumes/mac/webwork/2023/dati/template/admin/node_modules/vue-loader/lib/index.js","mtime":499162500000},{"path":"/Volumes/mac/webwork/2023/dati/template/admin/node_modules/iview-loader/index.js","mtime":1570440814000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7IHJlbGVhc2VkTGlzdEFwaSB9IGZyb20gJ0AvYXBpL21hcmtldGluZyc7CmltcG9ydCB7IGZvcm1hdERhdGUgfSBmcm9tICdAL3V0aWxzL3ZhbGlkYXRlJzsKCmV4cG9ydCBkZWZhdWx0IHsKICBuYW1lOiAnaW5kZXgnLAogIGZpbHRlcnM6IHsKICAgIGZvcm1hdERhdGUodGltZSkgewogICAgICBpZiAodGltZSAhPT0gMCkgewogICAgICAgIGxldCBkYXRlID0gbmV3IERhdGUodGltZSAqIDEwMDApOwogICAgICAgIHJldHVybiBmb3JtYXREYXRlKGRhdGUsICd5eXl5LU1NLWRkIGhoOm1tJyk7CiAgICAgIH0KICAgIH0sCiAgfSwKICBwcm9wczogewogICAgY291cG9uaWRzOiB7CiAgICAgIHR5cGU6IEFycmF5LAogICAgfSwKICAgIHVwZGF0ZUlkczogewogICAgICB0eXBlOiBBcnJheSwKICAgIH0sCiAgICB1cGRhdGVOYW1lOiB7CiAgICAgIHR5cGU6IEFycmF5LAogICAgfSwKICAgIGx1Y2tEcmF3OiB7CiAgICAgIHR5cGU6IEJvb2xlYW4sCiAgICAgIGRlZmF1bHQ6IGZhbHNlLAogICAgfSwKICB9LAogIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICBjdXJyZW50aWQ6IDAsCiAgICAgIHByb2R1Y3RSb3c6IHt9LAogICAgICBpc1RlbXBsYXRlOiBmYWxzZSwKICAgICAgbG9hZGluZzogZmFsc2UsCiAgICAgIHRhYmxlRnJvbTogewogICAgICAgIHJlY2VpdmVfdHlwZTogMywKICAgICAgICBwYWdlOiAxLAogICAgICAgIGxpbWl0OiAxMCwKICAgICAgfSwKICAgICAgdG90YWw6IDAsCiAgICAgIGlkczogW10sCiAgICAgIHRleHRzOiBbXSwKICAgICAgY29sdW1uczogWwogICAgICAgIHsKICAgICAgICAgIHRpdGxlOiAnSUQnLAogICAgICAgICAga2V5OiAnaWQnLAogICAgICAgICAgd2lkdGg6IDYwLAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgdGl0bGU6ICfkvJjmg6DliLjlkI3np7AnLAogICAgICAgICAga2V5OiAndGl0bGUnLAogICAgICAgICAgbWluV2lkdGg6IDE1MCwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgIHRpdGxlOiAn5LyY5oOg5Yi457G75Z6LJywKICAgICAgICAgIHNsb3Q6ICd0eXBlJywKICAgICAgICAgIG1pbldpZHRoOiA4MCwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgIHRpdGxlOiAn6Z2i5YC8JywKICAgICAgICAgIGtleTogJ2NvdXBvbl9wcmljZScsCiAgICAgICAgICBtaW5XaWR0aDogMTAwLAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgdGl0bGU6ICfmnIDkvY7mtojotLnpop0nLAogICAgICAgICAga2V5OiAndXNlX21pbl9wcmljZScsCiAgICAgICAgICBtaW5XaWR0aDogMTAwLAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgdGl0bGU6ICflj5HluIPmlbDph48nLAogICAgICAgICAgc2xvdDogJ2NvdW50JywKICAgICAgICAgIG1pbldpZHRoOiAxMjAsCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICB0aXRsZTogJ+acieaViOacn+mZkCcsCiAgICAgICAgICBzbG90OiAnc3RhcnRfdGltZScsCiAgICAgICAgICBtaW5XaWR0aDogMTIwLAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgdGl0bGU6ICfnirbmgIEnLAogICAgICAgICAgc2xvdDogJ3N0YXR1cycsCiAgICAgICAgICBtaW5XaWR0aDogODAsCiAgICAgICAgfSwKICAgICAgXSwKICAgICAgY291cG9uTGlzdDogW10sCiAgICAgIHNlbGVjdGVkSWRzOiBuZXcgU2V0KCksCiAgICAgIHNlbGVjdGVkTmFtZXM6IG5ldyBTZXQoKSwKICAgIH07CiAgfSwKICBtb3VudGVkKCkge30sCiAgd2F0Y2g6IHsKICAgIHVwZGF0ZUlkczogZnVuY3Rpb24gKG5ld1ZhbCkgewogICAgICB0aGlzLnNlbGVjdGVkSWRzID0gbmV3IFNldChuZXdWYWwpOwogICAgfSwKICAgIHVwZGF0ZU5hbWU6IGZ1bmN0aW9uIChuZXdWYWwpIHsKICAgICAgdGhpcy5zZWxlY3RlZE5hbWVzID0gbmV3IFNldChuZXdWYWwpOwogICAgfSwKICB9LAogIGNyZWF0ZWQoKSB7CiAgICBsZXQgcmFkaW8gPSB7CiAgICAgIHdpZHRoOiA2MCwKICAgICAgYWxpZ246ICdjZW50ZXInLAogICAgICByZW5kZXI6IChoLCBwYXJhbXMpID0+IHsKICAgICAgICBsZXQgaWQgPSBwYXJhbXMucm93LmlkOwogICAgICAgIGxldCBmbGFnID0gZmFsc2U7CiAgICAgICAgaWYgKHRoaXMuY3VycmVudGlkID09PSBpZCkgewogICAgICAgICAgZmxhZyA9IHRydWU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGZsYWcgPSBmYWxzZTsKICAgICAgICB9CiAgICAgICAgbGV0IHNlbGYgPSB0aGlzOwogICAgICAgIHJldHVybiBoKCdkaXYnLCBbCiAgICAgICAgICBoKCdSYWRpbycsIHsKICAgICAgICAgICAgcHJvcHM6IHsKICAgICAgICAgICAgICB2YWx1ZTogZmxhZywKICAgICAgICAgICAgfSwKICAgICAgICAgICAgb246IHsKICAgICAgICAgICAgICAnb24tY2hhbmdlJzogKCkgPT4gewogICAgICAgICAgICAgICAgc2VsZi5jdXJyZW50aWQgPSBpZDsKICAgICAgICAgICAgICAgIHRoaXMucHJvZHVjdFJvdyA9IHBhcmFtcy5yb3c7CiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgfSwKICAgICAgICAgIH0pLAogICAgICAgIF0pOwogICAgICB9LAogICAgfTsKCiAgICBsZXQgY2hlY2tib3ggPSB7CiAgICAgIHR5cGU6ICdzZWxlY3Rpb24nLAogICAgICB3aWR0aDogNjAsCiAgICAgIGFsaWduOiAnY2VudGVyJywKICAgIH07CiAgICBpZiAodGhpcy5sdWNrRHJhdykgewogICAgICB0aGlzLmNvbHVtbnMudW5zaGlmdChyYWRpbyk7CiAgICB9IGVsc2UgewogICAgICB0aGlzLmNvbHVtbnMudW5zaGlmdChjaGVja2JveCk7CiAgICB9CiAgfSwKICBtZXRob2RzOiB7CiAgICAvL+WvueixoeaVsOe7hOWOu+mHje+8mwogICAgdW5pcXVlKGFycikgewogICAgICBjb25zdCByZXMgPSBuZXcgTWFwKCk7CiAgICAgIHJldHVybiBhcnIuZmlsdGVyKChhcnIpID0+ICFyZXMuaGFzKGFyci5pZCkgJiYgcmVzLnNldChhcnIuaWQsIDEpKTsKICAgIH0sCiAgICBoYW5kbGVTZWxlY3RBbGwoc2VsZWN0aW9uKSB7CiAgICAgIC8vIOWPlua2iOWFqOmAiSDmlbDnu4TkuLrnqboKICAgICAgaWYgKHNlbGVjdGlvbi5sZW5ndGggPT09IDApIHsKICAgICAgICAvLyBjeSDoi6Xlj5bmtojlhajpgInvvIzliKDpmaTkv53lrZjlnKhzZWxlY3RlZElkc+mHjOWSjOW9k+WJjXRhYmxl5pWw5o2u55qEaWTkuIDoh7TnmoTmlbDmja7vvIzovr7liLDvvIzlvZPliY3pobXlj5bmtojlhajpgInnmoTmlYjmnpwKICAgICAgICAvLyDlvZPliY3pobXnmoR0YWJsZeaVsOaNrgogICAgICAgIGxldCB0aGF0ID0gdGhpczsKICAgICAgICBsZXQgZGF0YSA9IHRoYXQuJHJlZnMudGFibGUuZGF0YTsKICAgICAgICBkYXRhLmZvckVhY2goKGl0ZW0pID0+IHsKICAgICAgICAgIGlmICh0aGF0LnNlbGVjdGVkSWRzLmhhcyhpdGVtLmlkKSkgewogICAgICAgICAgICB0aGF0LnNlbGVjdGVkSWRzLmRlbGV0ZShpdGVtLmlkKTsKICAgICAgICAgICAgbGV0IG5hbWVMaXN0ID0gdGhhdC51bmlxdWUoQXJyYXkuZnJvbSh0aGF0LnNlbGVjdGVkTmFtZXMpKTsKICAgICAgICAgICAgdGhhdC51bmlxdWUoQXJyYXkuZnJvbSh0aGF0LnNlbGVjdGVkTmFtZXMpKS5mb3JFYWNoKChqLCBpbmRleCkgPT4gewogICAgICAgICAgICAgIGlmIChqLmlkID09PSBpdGVtLmlkKSB7CiAgICAgICAgICAgICAgICBuYW1lTGlzdC5zcGxpY2UoaW5kZXgsIDEpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHRoYXQuc2VsZWN0ZWROYW1lcyA9IG5ldyBTZXQobmFtZUxpc3QpOwogICAgICAgICAgICAvLyB0aGlzLnNlbGVjdGVkTmFtZXMuY2xlYXIoKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICBzZWxlY3Rpb24uZm9yRWFjaCgoaXRlbSkgPT4gewogICAgICAgICAgdGhpcy5zZWxlY3RlZElkcy5hZGQoaXRlbS5pZCk7CiAgICAgICAgICB0aGlzLnNlbGVjdGVkTmFtZXMuYWRkKHsgaWQ6IGl0ZW0uaWQsIHRpdGxlOiBpdGVtLnRpdGxlIH0pOwogICAgICAgIH0pOwogICAgICB9CiAgICAgIHRoaXMuJG5leHRUaWNrKCgpID0+IHsKICAgICAgICAvL+ehruS/nWRvbeWKoOi9veWujOavlQogICAgICAgIHRoaXMuc2V0Q2hlY2tlZCgpOwogICAgICB9KTsKICAgIH0sCgogICAgLy8gIOmAieS4reafkOS4gOihjAogICAgaGFuZGxlU2VsZWN0Um93KHNlbGVjdGlvbiwgcm93KSB7CiAgICAgIHRoaXMuc2VsZWN0ZWRJZHMuYWRkKHJvdy5pZCk7CiAgICAgIHRoaXMuc2VsZWN0ZWROYW1lcy5hZGQoeyBpZDogcm93LmlkLCB0aXRsZTogcm93LnRpdGxlIH0pOwogICAgICB0aGlzLiRuZXh0VGljaygoKSA9PiB7CiAgICAgICAgLy/noa7kv51kb23liqDovb3lrozmr5UKICAgICAgICB0aGlzLnNldENoZWNrZWQoKTsKICAgICAgfSk7CiAgICB9LAogICAgLy8gIOWPlua2iOafkOS4gOihjAogICAgaGFuZGxlQ2FuY2VsUm93KHNlbGVjdGlvbiwgcm93KSB7CiAgICAgIGxldCB0aGF0ID0gdGhpczsKICAgICAgdGhhdC5zZWxlY3RlZElkcy5kZWxldGUocm93LmlkKTsKICAgICAgbGV0IG5hbWVMaXN0ID0gQXJyYXkuZnJvbSh0aGF0LnNlbGVjdGVkTmFtZXMpOwogICAgICBBcnJheS5mcm9tKHRoYXQuc2VsZWN0ZWROYW1lcykuZm9yRWFjaCgoaXRlbSwgaW5kZXgpID0+IHsKICAgICAgICBpZiAoaXRlbS5pZCA9PT0gcm93LmlkKSB7CiAgICAgICAgICBuYW1lTGlzdC5zcGxpY2UoaW5kZXgsIDEpOwogICAgICAgIH0KICAgICAgfSk7CiAgICAgIHRoYXQuc2VsZWN0ZWROYW1lcyA9IG5ldyBTZXQobmFtZUxpc3QpOwogICAgICB0aGlzLiRuZXh0VGljaygoKSA9PiB7CiAgICAgICAgLy/noa7kv51kb23liqDovb3lrozmr5UKICAgICAgICB0aGlzLnNldENoZWNrZWQoKTsKICAgICAgfSk7CiAgICB9LAogICAgc2V0Q2hlY2tlZCgpIHsKICAgICAgdGhpcy5pZHMgPSBbLi4udGhpcy5zZWxlY3RlZElkc107CiAgICAgIHRoaXMudGV4dHMgPSBbLi4udGhpcy5zZWxlY3RlZE5hbWVzXTsKICAgICAgLy8g5om+5Yiw57uR5a6a55qEdGFibGXnmoRyZWblr7nlupTnmoRkb23vvIzmib7liLB0YWJsZeeahG9iakRhdGHlr7nosaHvvIxvYmpEYXRh5L+d5a2Y55qE5piv5b2T5YmN6aG155qE5pWw5o2uCiAgICAgIGxldCBvYmpEYXRhID0gdGhpcy4kcmVmcy50YWJsZS5vYmpEYXRhOwogICAgICBmb3IgKGxldCBpbmRleCBpbiBvYmpEYXRhKSB7CiAgICAgICAgaWYgKHRoaXMuc2VsZWN0ZWRJZHMuaGFzKG9iakRhdGFbaW5kZXhdLmlkKSkgewogICAgICAgICAgLy8gY3kg5byK56uvIOavj+asoeWIh+aNonNlbGVjdOmDveS8muinpuWPkXRhYmxl55qEb24tc2VsZWN05LqL5Lu2CiAgICAgICAgICAvLyB0aGlzLiRyZWZzLnB1cmNoYXNlVGFibGUudG9nZ2xlU2VsZWN0KGluZGV4KSAvLyDlnKjkv53lrZjpgInkuK3nmoRpZHPnmoRzZXTlkIjpm4bph4zmib7kuI7lvZPliY3pobXmlbDmja5pZOS4gOagt+eahOihjO+8jOS9v+eUqHRvZ2dsZVNlbGVjdO+8iGluZGV477yJ77yM5bCG6L+Z5LiA6KGM6YCJ5LitCiAgICAgICAgICAvLyBjeSDmlLnov5sKICAgICAgICAgIG9iakRhdGFbaW5kZXhdLl9pc0NoZWNrZWQgPSB0cnVlOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIGNhbmNlbCgpIHsKICAgICAgdGhpcy5pc1RlbXBsYXRlID0gZmFsc2U7CiAgICAgIGlmICh0aGlzLmx1Y2tEcmF3KSB7CiAgICAgICAgdGhpcy5jdXJyZW50aWQgPSAwOwogICAgICB9CiAgICB9LAogICAgdGFibGVMaXN0KCkgewogICAgICB0aGlzLmxvYWRpbmcgPSB0cnVlOwogICAgICByZWxlYXNlZExpc3RBcGkodGhpcy50YWJsZUZyb20pLnRoZW4oKHJlcykgPT4gewogICAgICAgIGxldCBkYXRhID0gcmVzLmRhdGE7CiAgICAgICAgdGhpcy5jb3Vwb25MaXN0ID0gZGF0YS5saXN0OwogICAgICAgIHRoaXMuJG5leHRUaWNrKCgpID0+IHsKICAgICAgICAgIC8v56Gu5L+dZG9t5Yqg6L295a6M5q+VCiAgICAgICAgICB0aGlzLnNldENoZWNrZWQoKTsKICAgICAgICB9KTsKICAgICAgICB0aGlzLnRvdGFsID0gZGF0YS5jb3VudDsKICAgICAgICB0aGlzLmxvYWRpbmcgPSBmYWxzZTsKICAgICAgfSk7CiAgICB9LAogICAgb2soKSB7CiAgICAgIGlmICh0aGlzLmx1Y2tEcmF3KSB7CiAgICAgICAgdGhpcy4kZW1pdCgnZ2V0Q291cG9uSWQnLCB0aGlzLnByb2R1Y3RSb3cpOwogICAgICAgIHRoaXMuY3VycmVudGlkID0gMDsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLiRlbWl0KCduYW1lSWQnLCB0aGlzLmlkcywgdGhpcy50ZXh0cyk7CiAgICAgIH0KICAgIH0sCiAgICByZWNlaXZlUGFnZUNoYW5nZShpbmRleCkgewogICAgICB0aGlzLnRhYmxlRnJvbS5wYWdlID0gaW5kZXg7CiAgICAgIHRoaXMudGFibGVMaXN0KCk7CiAgICB9LAogIH0sCn07Cg=="},{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAgDA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/components/couponList","sourcesContent":["<template>\n  <div>\n    <Modal v-model=\"isTemplate\" title=\"优惠券列表\" width=\"60%\" @on-ok=\"ok\" @on-cancel=\"cancel\">\n      <Table\n        :columns=\"columns\"\n        :data=\"couponList\"\n        ref=\"table\"\n        class=\"mt25\"\n        :loading=\"loading\"\n        highlight-row\n        @on-select=\"handleSelectRow\"\n        @on-select-cancel=\"handleCancelRow\"\n        @on-select-all=\"handleSelectAll\"\n        @on-select-all-cancel=\"handleSelectAll\"\n        no-userFrom-text=\"暂无数据\"\n        no-filtered-userFrom-text=\"暂无筛选结果\"\n      >\n        <template slot-scope=\"{ row, index }\" slot=\"count\">\n          <span v-if=\"row.is_permanent\">不限量</span>\n          <div v-else>\n            <span class=\"fa\">发布：{{ row.total_count }}</span>\n            <span class=\"sheng\">剩余：{{ row.remain_count }}</span>\n          </div>\n        </template>\n        <template slot-scope=\"{ row, index }\" slot=\"start_time\">\n          <div v-if=\"row.start_time\">{{ row.start_time | formatDate }} - {{ row.end_time | formatDate }}</div>\n          <span v-else>不限时</span>\n        </template>\n        <template slot-scope=\"{ row }\" slot=\"type\">\n          <span v-if=\"row.type === 1\">品类券</span>\n          <span v-else-if=\"row.type === 2\">商品券</span>\n          <span v-else-if=\"row.type === 3\">会员券</span>\n          <span v-else>通用券</span>\n        </template>\n        <template slot-scope=\"{ row, index }\" slot=\"status\">\n          <Tag color=\"blue\" v-show=\"row.status === 1\">正常</Tag>\n          <Tag color=\"gold\" v-show=\"row.status === 0\">未开启</Tag>\n          <Tag color=\"red\" v-show=\"row.status === -1\">已失效</Tag>\n        </template>\n      </Table>\n      <div class=\"acea-row row-right page\">\n        <Page :total=\"total\" show-elevator show-total @on-change=\"receivePageChange\" :page-size=\"tableFrom.limit\" />\n      </div>\n    </Modal>\n  </div>\n</template>\n\n<script>\nimport { releasedListApi } from '@/api/marketing';\nimport { formatDate } from '@/utils/validate';\n\nexport default {\n  name: 'index',\n  filters: {\n    formatDate(time) {\n      if (time !== 0) {\n        let date = new Date(time * 1000);\n        return formatDate(date, 'yyyy-MM-dd hh:mm');\n      }\n    },\n  },\n  props: {\n    couponids: {\n      type: Array,\n    },\n    updateIds: {\n      type: Array,\n    },\n    updateName: {\n      type: Array,\n    },\n    luckDraw: {\n      type: Boolean,\n      default: false,\n    },\n  },\n  data() {\n    return {\n      currentid: 0,\n      productRow: {},\n      isTemplate: false,\n      loading: false,\n      tableFrom: {\n        receive_type: 3,\n        page: 1,\n        limit: 10,\n      },\n      total: 0,\n      ids: [],\n      texts: [],\n      columns: [\n        {\n          title: 'ID',\n          key: 'id',\n          width: 60,\n        },\n        {\n          title: '优惠券名称',\n          key: 'title',\n          minWidth: 150,\n        },\n        {\n          title: '优惠券类型',\n          slot: 'type',\n          minWidth: 80,\n        },\n        {\n          title: '面值',\n          key: 'coupon_price',\n          minWidth: 100,\n        },\n        {\n          title: '最低消费额',\n          key: 'use_min_price',\n          minWidth: 100,\n        },\n        {\n          title: '发布数量',\n          slot: 'count',\n          minWidth: 120,\n        },\n        {\n          title: '有效期限',\n          slot: 'start_time',\n          minWidth: 120,\n        },\n        {\n          title: '状态',\n          slot: 'status',\n          minWidth: 80,\n        },\n      ],\n      couponList: [],\n      selectedIds: new Set(),\n      selectedNames: new Set(),\n    };\n  },\n  mounted() {},\n  watch: {\n    updateIds: function (newVal) {\n      this.selectedIds = new Set(newVal);\n    },\n    updateName: function (newVal) {\n      this.selectedNames = new Set(newVal);\n    },\n  },\n  created() {\n    let radio = {\n      width: 60,\n      align: 'center',\n      render: (h, params) => {\n        let id = params.row.id;\n        let flag = false;\n        if (this.currentid === id) {\n          flag = true;\n        } else {\n          flag = false;\n        }\n        let self = this;\n        return h('div', [\n          h('Radio', {\n            props: {\n              value: flag,\n            },\n            on: {\n              'on-change': () => {\n                self.currentid = id;\n                this.productRow = params.row;\n              },\n            },\n          }),\n        ]);\n      },\n    };\n\n    let checkbox = {\n      type: 'selection',\n      width: 60,\n      align: 'center',\n    };\n    if (this.luckDraw) {\n      this.columns.unshift(radio);\n    } else {\n      this.columns.unshift(checkbox);\n    }\n  },\n  methods: {\n    //对象数组去重；\n    unique(arr) {\n      const res = new Map();\n      return arr.filter((arr) => !res.has(arr.id) && res.set(arr.id, 1));\n    },\n    handleSelectAll(selection) {\n      // 取消全选 数组为空\n      if (selection.length === 0) {\n        // cy 若取消全选，删除保存在selectedIds里和当前table数据的id一致的数据，达到，当前页取消全选的效果\n        // 当前页的table数据\n        let that = this;\n        let data = that.$refs.table.data;\n        data.forEach((item) => {\n          if (that.selectedIds.has(item.id)) {\n            that.selectedIds.delete(item.id);\n            let nameList = that.unique(Array.from(that.selectedNames));\n            that.unique(Array.from(that.selectedNames)).forEach((j, index) => {\n              if (j.id === item.id) {\n                nameList.splice(index, 1);\n              }\n            });\n            that.selectedNames = new Set(nameList);\n            // this.selectedNames.clear();\n          }\n        });\n      } else {\n        selection.forEach((item) => {\n          this.selectedIds.add(item.id);\n          this.selectedNames.add({ id: item.id, title: item.title });\n        });\n      }\n      this.$nextTick(() => {\n        //确保dom加载完毕\n        this.setChecked();\n      });\n    },\n\n    //  选中某一行\n    handleSelectRow(selection, row) {\n      this.selectedIds.add(row.id);\n      this.selectedNames.add({ id: row.id, title: row.title });\n      this.$nextTick(() => {\n        //确保dom加载完毕\n        this.setChecked();\n      });\n    },\n    //  取消某一行\n    handleCancelRow(selection, row) {\n      let that = this;\n      that.selectedIds.delete(row.id);\n      let nameList = Array.from(that.selectedNames);\n      Array.from(that.selectedNames).forEach((item, index) => {\n        if (item.id === row.id) {\n          nameList.splice(index, 1);\n        }\n      });\n      that.selectedNames = new Set(nameList);\n      this.$nextTick(() => {\n        //确保dom加载完毕\n        this.setChecked();\n      });\n    },\n    setChecked() {\n      this.ids = [...this.selectedIds];\n      this.texts = [...this.selectedNames];\n      // 找到绑定的table的ref对应的dom，找到table的objData对象，objData保存的是当前页的数据\n      let objData = this.$refs.table.objData;\n      for (let index in objData) {\n        if (this.selectedIds.has(objData[index].id)) {\n          // cy 弊端 每次切换select都会触发table的on-select事件\n          // this.$refs.purchaseTable.toggleSelect(index) // 在保存选中的ids的set合集里找与当前页数据id一样的行，使用toggleSelect（index），将这一行选中\n          // cy 改进\n          objData[index]._isChecked = true;\n        }\n      }\n    },\n    cancel() {\n      this.isTemplate = false;\n      if (this.luckDraw) {\n        this.currentid = 0;\n      }\n    },\n    tableList() {\n      this.loading = true;\n      releasedListApi(this.tableFrom).then((res) => {\n        let data = res.data;\n        this.couponList = data.list;\n        this.$nextTick(() => {\n          //确保dom加载完毕\n          this.setChecked();\n        });\n        this.total = data.count;\n        this.loading = false;\n      });\n    },\n    ok() {\n      if (this.luckDraw) {\n        this.$emit('getCouponId', this.productRow);\n        this.currentid = 0;\n      } else {\n        this.$emit('nameId', this.ids, this.texts);\n      }\n    },\n    receivePageChange(index) {\n      this.tableFrom.page = index;\n      this.tableList();\n    },\n  },\n};\n</script>\n\n<style scoped></style>\n"]}]}