{"remainingRequest":"/Volumes/mac/webwork/2023/dati/template/admin/node_modules/vue-loader/lib/index.js??vue-loader-options!/Volumes/mac/webwork/2023/dati/template/admin/node_modules/iview-loader/index.js??ref--0-2!/Volumes/mac/webwork/2023/dati/template/admin/src/pages/kefu/mobile/chat_list.vue?vue&type=style&index=0&lang=css&","dependencies":[{"path":"/Volumes/mac/webwork/2023/dati/template/admin/src/pages/kefu/mobile/chat_list.vue","mtime":1689324015212},{"path":"/Volumes/mac/webwork/2023/dati/template/admin/node_modules/@vue/cli-service/node_modules/css-loader/index.js","mtime":499162500000},{"path":"/Volumes/mac/webwork/2023/dati/template/admin/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/Volumes/mac/webwork/2023/dati/template/admin/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/Volumes/mac/webwork/2023/dati/template/admin/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Volumes/mac/webwork/2023/dati/template/admin/node_modules/vue-loader/lib/index.js","mtime":499162500000},{"path":"/Volumes/mac/webwork/2023/dati/template/admin/node_modules/iview-loader/index.js","mtime":1570440814000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCmh0bWwsCmJvZHkgewogIGZvbnQtc2l6ZTogNTBweDsKfQo="},{"version":3,"sources":["chat_list.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA8UA;AACA;AACA;AACA","file":"chat_list.vue","sourceRoot":"src/pages/kefu/mobile","sourcesContent":["<template>\n  <div class=\"chat-list\">\n    <div class=\"head-box\">\n      <div class=\"hd\">\n        <div class=\"left-wrappers\">\n          <img v-lazy=\"kefuInfo.avatar\" />\n          <div class=\"info\" @click=\"isOnLine = !isOnLine\">\n            <div>{{ kefuInfo.nickname }}</div>\n            <div class=\"status\">\n              <span class=\"doc\" :class=\"{ off: !kefuInfo.online }\"></span>\n              <span>{{ kefuInfo.online ? '在线' : '离线' }}</span>\n            </div>\n          </div>\n          <div class=\"down-wrapper\" v-show=\"isOnLine\">\n            <div class=\"item\" @click=\"changOnline(1)\">\n              <span class=\"dot green\"></span>在线\n              <span class=\"iconfont iconduihao\" v-if=\"kefuInfo.online\"></span>\n            </div>\n            <div class=\"item\" @click=\"changOnline(0)\">\n              <span class=\"dot\"></span>离线\n              <span class=\"iconfont iconduihao\" v-if=\"!kefuInfo.online\"></span>\n            </div>\n          </div>\n        </div>\n        <div class=\"right-wrapper\" @click=\"outLogin\">\n          <div class=\"icon-box\"><span class=\"iconfont icontuichu\"></span></div>\n\n          <div style=\"margin-left: 5px\">退出登录</div>\n        </div>\n      </div>\n      <div class=\"tab-box\">\n        <div\n          class=\"tab-item\"\n          :class=\"{ on: tabCur == item.key }\"\n          v-for=\"(item, index) in tabList\"\n          @click=\"changeClass(item)\"\n        >\n          {{ item.title }}\n        </div>\n      </div>\n      <div class=\"search-box\">\n        <Input v-model=\"searchTxt\" placeholder=\"搜索用户名称\" @on-enter=\"bindSearch\" />\n      </div>\n    </div>\n    <div class=\"list-box\" v-if=\"list.length > 0\">\n      <vue-scroll ref=\"vs\" :ops=\"ops\" @load-before-deactivate=\"handleBeforeDeactivate\">\n        <div class=\"item\" v-for=\"(item, index) in list\" :key=\"index\" @click=\"goPage(item)\">\n          <div class=\"left-wrappers\">\n            <div class=\"img-box\">\n              <img v-lazy=\"item.avatar\" />\n              <div class=\"online\" :class=\"{ on: item.online }\"></div>\n            </div>\n            <div class=\"info\">\n              <div class=\"title\">\n                <span class=\"line1\">{{ item.nickname }}</span>\n                <template v-if=\"item.type == 2\">\n                  <span class=\"label\">小程序</span>\n                </template>\n                <template v-if=\"item.type == 3\">\n                  <span class=\"label h5\">H5</span>\n                </template>\n                <template v-if=\"item.type == 1\">\n                  <span class=\"label wx\">公众号</span>\n                </template>\n                <template v-if=\"item.type == 0\">\n                  <span class=\"label pc\">PC端</span>\n                </template>\n              </div>\n              <div class=\"msg line1\" v-if=\"item.message_type == 1\">{{ item.message }}</div>\n              <div class=\"msg\" v-if=\"item.message_type == 2\">[表情]</div>\n              <div class=\"msg\" v-if=\"item.message_type == 3\">[图片]</div>\n              <div class=\"msg\" v-if=\"item.message_type == 5\">[商品]</div>\n              <div class=\"msg\" v-if=\"item.message_type == 6\">[订单]</div>\n            </div>\n          </div>\n          <div class=\"right-wrapper\">\n            <div class=\"time\">{{ item.update_time | toDay }}</div>\n            <span class=\"num\" v-if=\"item.mssage_num > 0\">{{ item.mssage_num }}</span>\n          </div>\n        </div>\n        <div class=\"slot-load\" slot=\"load-deactive\"></div>\n        <div class=\"slot-load\" slot=\"load-active\">下滑加载更多</div>\n      </vue-scroll>\n    </div>\n    <empty v-else status=\"3\" msg=\"暂无用户列表\"></empty>\n  </div>\n</template>\n\n<script>\nimport util from '@/libs/util';\nimport { Socket } from '@/libs/socket';\nimport { record } from '@/api/kefu.js';\nimport { serviceInfo } from '@/api/kefu_mobile';\nimport { HappyScroll } from 'vue-happy-scroll';\nimport { mapState, mapActions } from 'vuex';\nimport { getCookies } from '@/libs/util';\nimport empty from '../components/empty';\nvar mp3 = require('@/assets/video/notice.mp3');\nvar mp3 = new Audio(mp3);\nexport default {\n  name: 'chat_list.vue',\n  components: {\n    HappyScroll,\n    empty,\n  },\n  data() {\n    return {\n      ops: {\n        vuescroll: {\n          mode: 'slide',\n          enable: false,\n          tips: {\n            deactive: 'Push to Load',\n            active: 'Release to Load',\n            start: 'Loading...',\n            beforeDeactive: 'Load Successfully!',\n          },\n          auto: false,\n          autoLoadDistance: 0,\n          pullRefresh: {\n            enable: false,\n          },\n          pushLoad: {\n            enable: true,\n            auto: true,\n            autoLoadDistance: 10,\n          },\n        },\n        bar: {\n          background: '#393232',\n          opacity: '.5',\n          size: '2px',\n        },\n      },\n      list: [],\n      page: 1,\n      limit: 10,\n      isScroll: true,\n      searchTxt: '',\n      isOpen: true,\n      kefuInfo: {},\n      isOnLine: false,\n      tabCur: 0,\n      tabList: [\n        {\n          key: 0,\n          title: '用户列表',\n        },\n        {\n          key: 1,\n          title: '游客列表',\n        },\n      ],\n      wsLogin: JSON.parse(sessionStorage.getItem('wsLogin')),\n    };\n  },\n  filters: {\n    toDay: function (value) {\n      if (!value) return '';\n      var date = new Date(); //时间戳为10位需*1000，时间戳为13位的话不需乘1000\n      var Y = date.getFullYear() + '-';\n      var M = (date.getMonth() + 1 < 10 ? '0' + (date.getMonth() + 1) : date.getMonth() + 1) + '-';\n      var D = (date.getDate() < 10 ? '0' + date.getDate() : date.getDate()) + ' ';\n      var h = (date.getHours() < 10 ? '0' + date.getHours() : date.getHours()) + ':';\n      var m = date.getMinutes() < 10 ? '0' + date.getMinutes() : date.getMinutes();\n      var s = date.getSeconds() < 10 ? '0' + date.getSeconds() : date.getSeconds();\n\n      value = M + D + h + m;\n      return value;\n    },\n  },\n  created() {\n    Promise.all([this.getKefuInfo(), this.getList()]);\n  },\n  mounted() {\n    let that = this;\n    // 监听页面刷新\n    window.addEventListener('beforeunload', (e) => {\n      sessionStorage.setItem('wsLogin', false);\n    });\n    // 获取是否登录的key\n    this.wsLogin = JSON.parse(sessionStorage.getItem('wsLogin'));\n    let token = getCookies('kefu_token');\n    Socket.then((ws) => {\n      if (!that.wsLogin && token) {\n        ws.send({\n          type: 'kefu_login',\n          data: getCookies('kefu_token'),\n        });\n      }\n      //用户未读消息条数更改\n      ws.$on('transfer', (data) => {\n        if (data.recored.id) {\n          let status = false;\n          for (let i = 0; i < this.list.length; i++) {\n            if (data.recored.id == this.list[i].id) {\n              status = true;\n              this.$set(this.list, i, data.recored);\n            }\n          }\n          if (!status) {\n            this.list.unshift(data.recored);\n          }\n        }\n      });\n      ws.$on('mssage_num', (data) => {\n        if (data.num > 0) {\n          mp3.play();\n        }\n        if (data.recored.id) {\n          let status = false;\n          // for(let i =0 ;i<this.list.length;i++){\n          //     if(data.recored.id == this.list[i].id){\n          //         status = true\n          //         this.$set(this.list, i, data.recored)\n          //         break\n          //     }\n          // }\n          that.list.forEach((el, index, arr) => {\n            if (data.recored.id == el.id) {\n              status = true;\n              if (data.recored.is_tourist == that.tabCur) {\n                let oldVal = data.recored;\n                arr.splice(index, 1);\n                arr.unshift(oldVal);\n              }\n            }\n          });\n          if (!status) {\n            if (data.recored.is_tourist == this.tabCur) this.list.unshift(data.recored);\n          }\n          if (data.recored.is_tourist != this.tabCur && data.recored.id) {\n            this.$Notice.info({\n              title: this.tabCur ? '用户发来消息啦！' : '游客发来消息啦！',\n            });\n          }\n        }\n      });\n      // ws登录成功\n      ws.$on('success', (data) => {\n        sessionStorage.setItem('wsLogin', true);\n      });\n    });\n  },\n  beforeDestroy() {},\n  methods: {\n    ...mapActions('kefu/', ['logout', 'logoutKefu']),\n    // 列表切换\n    changeClass(item) {\n      if (this.tabCur == item.key) return;\n      this.tabCur = item.key;\n      this.page = 1;\n      this.list = [];\n      this.isScroll = true;\n      this.getList();\n    },\n    // 客服上下线\n    changOnline(key) {\n      this.kefuInfo.online = key;\n      this.isOnLine = false;\n      Socket.then((ws) => {\n        let that = this;\n        ws.send({\n          type: 'online',\n          data: {\n            online: key,\n          },\n        });\n      });\n    },\n    // 客服详细信息\n    getKefuInfo() {\n      serviceInfo().then((res) => {\n        this.kefuInfo = res.data;\n        window.document.title = `${res.data.site_name} - 消息列表`;\n      });\n    },\n    getList() {\n      if (!this.isScroll) return;\n      record({\n        nickname: this.searchTxt,\n        page: this.page,\n        limit: this.limit,\n        is_tourist: this.tabCur,\n      }).then((res) => {\n        this.isScroll = res.data.length >= this.limit;\n        this.list = this.list.concat(res.data);\n        this.page++;\n        setTimeout(() => {\n          this.$refs.vs.refresh();\n        }, 100);\n      });\n    },\n    // 客服退出\n    outLogin() {\n      let self = this;\n      this.$Modal.confirm({\n        title: '退出登录确认',\n        content: '您确定退出登录当前账户吗？打开的标签页和个人设置将会保存。',\n        onOk: () => {\n          self.logoutKefu({\n            confirm: false,\n            vm: self,\n          });\n        },\n        onCancel: () => {},\n      });\n    },\n    // 搜索\n    bindSearch(e) {\n      this.page = 1;\n      this.list = [];\n      this.isScroll = true;\n      this.getList();\n    },\n    // 进入对话\n    goPage(item) {\n      this.$router.push({\n        path: 'mobile_chat',\n        query: {\n          toUid: item.to_uid,\n          nickname: item.nickname,\n          is_tourist: this.tabCur,\n        },\n      });\n    },\n    handleBeforeDeactivate(vm, refreshDom, done) {\n      this.getList();\n      done();\n    },\n  },\n};\n</script>\n<style>\nhtml,\nbody {\n  font-size: 50px;\n}\n</style>\n<style scoped lang=\"stylus\">\n\n.chat-list {\n    display: flex;\n    flex-direction: column;\n    width: 100%;\n    height: 100%;\n    padding-bottom 0.15rem;\n    background: #fff;\n\n    .head-box {\n        .hd {\n            position: relative;\n            display: flex;\n            align-items: center;\n            justify-content: space-between;\n            height: 1rem;\n            padding: 0 .3rem;\n            background: linear-gradient(90deg, #3875EA 0%, #1890FC 100%);\n\n            .left-wrappers {\n                position: relative;\n                display: flex;\n                align-items: center;\n                color: #fff;\n                font-size: .26rem;\n\n                img {\n                    width: .58rem;\n                    height: .58rem;\n                    border-radius: 50%;\n                }\n\n                .info {\n                    margin-left: .12rem;\n\n                    .status {\n                        display: flex;\n                        align-items: center;\n                        font-size: .2rem;\n\n                        .doc {\n                            width: .14rem;\n                            height: .14rem;\n                            margin-right: .1rem;\n                            background-color: #27F2CB;\n                            border-radius: 50%;\n                            margin-top: .04rem;\n\n                            &.off {\n                                background: #919191;\n                            }\n                        }\n                    }\n                }\n\n                .down-wrapper {\n                    z-index: 50;\n                    position: absolute;\n                    left: 0;\n                    bottom: -1.9rem;\n                    width: 2.14rem;\n                    background: #434343;\n                    border-radius: .1rem;\n\n                    .item {\n                        display: flex;\n                        align-items: center;\n                        height: .8rem;\n                        padding-left: .3rem;\n                        border-bottom: 1px solid rgba(240, 241, 242, 0.16);\n                        font-size: .28rem;\n\n                        &:last-child {\n                            border-bottom: none;\n                        }\n\n                        .dot {\n                            width: .12rem;\n                            height: .12rem;\n                            margin-right: .16rem;\n                            border-radius: 50%;\n                            background: linear-gradient(180deg, #BCBCBC 0%, #919191 100%);\n\n                            &.green {\n                                background: linear-gradient(143deg, #27F2CB 0%, #14E3B4 100%);\n                            }\n                        }\n\n                        .iconfont {\n                            margin-left: .36rem;\n                            color: #B9B9B9;\n                            font-size: .18rem;\n                        }\n                    }\n                }\n            }\n\n            .right-wrapper {\n                display: flex;\n                align-items: center;\n                color: #fff;\n                font-size: .24rem;\n            }\n        }\n\n        .search-box {\n            padding: 0 .3rem .2rem;\n            border-bottom: 1px solid #ECEFF8;\n\n\n            >>> .ivu-input {\n                display: block;\n                width: 100%;\n                height: .68rem;\n                background #F5F6F9\n                border-radius: .39rem;\n                box-sizing: border-box;\n                font-size: .28rem;\n                border-radius: .39rem;\n                text-align center\n            }\n            >>> .ivu-input, .ivu-input:hover, .ivu-input:focus {\n                border transparent\n                box-shadow: none;\n            }\n        }\n        .tab-box{\n            display flex\n            padding .2rem 0\n\n            .tab-item{\n                flex 1\n                height 100%\n                line-height .6rem\n                text-align center\n                font-size .3rem\n                &.on{\n                    color #3875ea\n                }\n                &:first-child{\n                    border-right 1px solid #ddd\n                }\n            }\n        }\n    }\n\n    .list-box {\n        flex: 1;\n        overflow hidden\n\n        .item {\n            display: flex;\n            justify-content: space-between;\n            padding: .23rem .3rem;\n            height: 1.5rem;\n\n            .left-wrappers {\n                display: flex;\n                align-items: center;\n                .img-box{\n                    width .96rem\n                    height .96rem\n                    position relative\n                }\n                .online{\n                    position absolute\n                    right: 0.1rem;\n                    bottom: 1px;\n                    width .16rem\n                    height .16rem\n                    background: linear-gradient(143deg, #BCBCBC 0%, #919191 100%);\n                    border-radius 50%\n                    border: 1px solid #FFFFFF;\n                    &.on{\n                        background: linear-gradient(143deg, #27F2CB 0%, #14E3B4 100%);\n                    }\n                }\n                img {\n                    width: .96rem;\n                    height: .96rem;\n                    border-radius: 50%;\n                }\n\n                .info {\n                    margin-left: .2rem;\n                    width: 3.5rem;\n                    height: .96rem;\n                    display: flex;\n                    flex-direction: column;\n                    justify-content: space-between;\n\n                    .title {\n                        display: flex;\n                        align-items: center;\n                        font-size: .3rem;\n\n                        .label {\n                            margin-left: .15rem;\n                            font-size: .2rem;\n                            padding: 0.05rem 0.1rem;\n                            background: rgba(56, 117, 234, 0.14);\n                            color: $kf-theme;\n                            border-radius: 0.04rem;\n\n                            &.h5 {\n                                background: rgba(255, 162, 0, 0.18);\n                                color: #D08800;\n                            }\n\n                            &.wx {\n                                background: rgba(0, 186, 100, 0.14);\n                                color: #00A219;\n                            }\n\n                            &.pc {\n                                background: rgba(133, 64, 227, 0.14);\n                                color: #820ADB;\n                            }\n                        }\n                    }\n\n                    .msg {\n                        font-size: .24rem;\n                        color: #9F9F9F;\n                    }\n                }\n            }\n\n            .right-wrapper {\n                height: .96rem;\n                color: #9F9F9F;\n                font-size: .22rem;\n                text-align right\n\n                .num {\n                    min-width: .12rem;\n                    background-color: #F74C31;\n                    color: #fff;\n                    border-radius: .15rem;\n                    right: 0 rpx;\n                    bottom: 0 rpx;\n                    font-size: .2rem;\n                    padding: 0 0.08rem;\n                }\n            }\n        }\n    }\n}\n</style>\n"]}]}