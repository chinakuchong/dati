{"remainingRequest":"/Volumes/mac/webwork/2023/dati/template/admin/node_modules/vue-loader/lib/index.js??vue-loader-options!/Volumes/mac/webwork/2023/dati/template/admin/node_modules/iview-loader/index.js??ref--0-2!/Volumes/mac/webwork/2023/dati/template/admin/src/pages/kefu/pc/components/chatList.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Volumes/mac/webwork/2023/dati/template/admin/src/pages/kefu/pc/components/chatList.vue","mtime":1689324015215},{"path":"/Volumes/mac/webwork/2023/dati/template/admin/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Volumes/mac/webwork/2023/dati/template/admin/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Volumes/mac/webwork/2023/dati/template/admin/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Volumes/mac/webwork/2023/dati/template/admin/node_modules/vue-loader/lib/index.js","mtime":499162500000},{"path":"/Volumes/mac/webwork/2023/dati/template/admin/node_modules/iview-loader/index.js","mtime":1570440814000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7IFNvY2tldCB9IGZyb20gJ0AvbGlicy9zb2NrZXQnOwppbXBvcnQgZGF5anMgZnJvbSAnZGF5anMnOwppbXBvcnQgeyByZWNvcmQgfSBmcm9tICdAL2FwaS9rZWZ1JzsKaW1wb3J0IHsgSGFwcHlTY3JvbGwgfSBmcm9tICd2dWUtaGFwcHktc2Nyb2xsJzsKaW1wb3J0IGVtcHR5IGZyb20gJy4uLy4uL2NvbXBvbmVudHMvZW1wdHknOwppbXBvcnQgeyBmb3JFYWNoIH0gZnJvbSAnLi4vLi4vLi4vLi4vbGlicy90b29scyc7CmV4cG9ydCBkZWZhdWx0IHsKICBuYW1lOiAnY2hhdExpc3QnLAogIHByb3BzOiB7CiAgICB1c2VyT25saW5lOiB7CiAgICAgIHR5cGU6IE9iamVjdCwKICAgICAgZGVmYXVsdDogZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiB7fTsKICAgICAgfSwKICAgIH0sCiAgICBuZXdSZWNvcmVkOiB7CiAgICAgIHR5cGU6IE9iamVjdCwKICAgICAgZGVmYXVsdDogZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiB7fTsKICAgICAgfSwKICAgIH0sCiAgICBzZWFyY2hEYXRhOiB7CiAgICAgIHR5cGU6IFN0cmluZywKICAgICAgZGVmYXVsdDogJycsCiAgICB9LAogIH0sCiAgY29tcG9uZW50czogewogICAgSGFwcHlTY3JvbGwsCiAgICBlbXB0eSwKICB9LAogIHdhdGNoOiB7CiAgICB1c2VyT25saW5lOiB7CiAgICAgIGhhbmRsZXIoblZhbCwgb1ZhbCkgewogICAgICAgIGlmIChuVmFsLmhhc093blByb3BlcnR5KCd0b191aWQnKSkgewogICAgICAgICAgdGhpcy51c2VyTGlzdC5mb3JFYWNoKChlbCwgaW5kZXgpID0+IHsKICAgICAgICAgICAgaWYgKGVsLnRvX3VpZCA9PSBuVmFsLnRvX3VpZCkgewogICAgICAgICAgICAgIGVsLm9ubGluZSA9IG5WYWwub25saW5lOwogICAgICAgICAgICAgIGlmIChuVmFsLm9ubGluZSA9PSAxKSB7CiAgICAgICAgICAgICAgICB0aGlzLiROb3RpY2UuaW5mbyh7CiAgICAgICAgICAgICAgICAgIHRpdGxlOiAn5LiK57q/6YCa55+lJywKICAgICAgICAgICAgICAgICAgZGVzYzogYCR7ZWwubmlja25hbWV95LiK57q/YCwKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9LAogICAgICBkZWVwOiB0cnVlLAogICAgfSwKICAgIHNlYXJjaERhdGE6IHsKICAgICAgaGFuZGxlcihuVmFsLCBvVmFsKSB7CiAgICAgICAgaWYgKG5WYWwgIT0gb1ZhbCkgewogICAgICAgICAgdGhpcy5uaWNrbmFtZSA9IG5WYWw7CiAgICAgICAgICB0aGlzLnBhZ2UgPSAxOwogICAgICAgICAgdGhpcy5pc1Njcm9sbCA9IHRydWU7CiAgICAgICAgICB0aGlzLnVzZXJMaXN0ID0gW107CiAgICAgICAgICB0aGlzLmlzU2VhcmNoID0gdHJ1ZTsKICAgICAgICAgIHRoaXMuZ2V0TGlzdCgpOwogICAgICAgIH0KICAgICAgfSwKICAgICAgZGVlcDogdHJ1ZSwKICAgIH0sCiAgfSwKICBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgaGRUYWJDdXI6IDAsCiAgICAgIGhkVGFiOiBbCiAgICAgICAgewogICAgICAgICAga2V5OiAwLAogICAgICAgICAgdGl0bGU6ICfnlKjmiLfliJfooagnLAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAga2V5OiAxLAogICAgICAgICAgdGl0bGU6ICfmuLjlrqLliJfooagnLAogICAgICAgIH0sCiAgICAgIF0sCiAgICAgIHVzZXJMaXN0OiBbXSwKICAgICAgY3VySWQ6ICcnLAogICAgICBwYWdlOiAxLAogICAgICBsaW1pdDogMTUsCiAgICAgIGlzU2Nyb2xsOiB0cnVlLAogICAgICBuaWNrbmFtZTogJycsCiAgICAgIGlzU2VhcmNoOiBmYWxzZSwKICAgICAgb3BzOiB7CiAgICAgICAgdnVlc2Nyb2xsOiB7CiAgICAgICAgICBtb2RlOiAnbmF0aXZlJywKICAgICAgICAgIGVuYWJsZTogZmFsc2UsCiAgICAgICAgICB0aXBzOiB7CiAgICAgICAgICAgIGRlYWN0aXZlOiAnUHVzaCB0byBMb2FkJywKICAgICAgICAgICAgYWN0aXZlOiAnUmVsZWFzZSB0byBMb2FkJywKICAgICAgICAgICAgc3RhcnQ6ICdMb2FkaW5nLi4uJywKICAgICAgICAgICAgYmVmb3JlRGVhY3RpdmU6ICdMb2FkIFN1Y2Nlc3NmdWxseSEnLAogICAgICAgICAgfSwKICAgICAgICAgIGF1dG86IGZhbHNlLAogICAgICAgICAgYXV0b0xvYWREaXN0YW5jZTogMCwKICAgICAgICAgIHB1bGxSZWZyZXNoOiB7CiAgICAgICAgICAgIGVuYWJsZTogZmFsc2UsCiAgICAgICAgICB9LAogICAgICAgICAgcHVzaExvYWQ6IHsKICAgICAgICAgICAgZW5hYmxlOiB0cnVlLAogICAgICAgICAgICBhdXRvOiB0cnVlLAogICAgICAgICAgICBhdXRvTG9hZERpc3RhbmNlOiAxMCwKICAgICAgICAgIH0sCiAgICAgICAgfSwKICAgICAgICBiYXI6IHsKICAgICAgICAgIGJhY2tncm91bmQ6ICcjMzkzMjMyJywKICAgICAgICAgIG9wYWNpdHk6ICcuNScsCiAgICAgICAgICBzaXplOiAnNXB4JywKICAgICAgICB9LAogICAgICB9LAogICAgfTsKICB9LAogIGZpbHRlcnM6IHsKICAgIHRvRGF5OiBmdW5jdGlvbiAodmFsdWUpIHsKICAgICAgaWYgKCF2YWx1ZSkgcmV0dXJuICcnOwogICAgICByZXR1cm4gZGF5anMudW5peCh2YWx1ZSkuZm9ybWF0KCdN5pyIROaXpSBISDptbScpOwogICAgfSwKICB9LAogIG1vdW50ZWQoKSB7CiAgICBsZXQgdGhhdCA9IHRoaXM7CiAgICBTb2NrZXQudGhlbigod3MpID0+IHsKICAgICAgLy/nlKjmiLfovazmjqUKICAgICAgd3MuJG9uKCd0cmFuc2ZlcicsIChkYXRhKSA9PiB7CiAgICAgICAgbGV0IHN0YXR1cyA9IGZhbHNlOwogICAgICAgIHRoYXQudXNlckxpc3QuZm9yRWFjaCgoZWwsIGluZGV4LCBhcnIpID0+IHsKICAgICAgICAgIGlmIChkYXRhLnJlY29yZWQuaWQgPT0gZWwuaWQpIHsKICAgICAgICAgICAgc3RhdHVzID0gdHJ1ZTsKICAgICAgICAgICAgaWYgKGRhdGEucmVjb3JlZC5pc190b3VyaXN0ID09IHRoYXQuaGRUYWJDdXIpIHsKICAgICAgICAgICAgICBsZXQgb2xkVmFsID0gZGF0YS5yZWNvcmVkOwogICAgICAgICAgICAgIGFyci5zcGxpY2UoaW5kZXgsIDEpOwoKICAgICAgICAgICAgICBpZiAoaW5kZXggPT0gMCkgewogICAgICAgICAgICAgICAgdGhpcy4kZW1pdCgnc2V0RGF0YUlkJywgb2xkVmFsKTsKICAgICAgICAgICAgICAgIG9sZFZhbC5tc3NhZ2VfbnVtID0gMDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgYXJyLnVuc2hpZnQob2xkVmFsKTsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLiROb3RpY2UuaW5mbyh7CiAgICAgICAgICAgICAgdGl0bGU6ICfmgqjmnInkuIDmnaHovazmjqXmtojmga/vvIEnLAogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICBpZiAoIXN0YXR1cykgewogICAgICAgICAgaWYgKGRhdGEucmVjb3JlZC5pc190b3VyaXN0ID09IHRoaXMuaGRUYWJDdXIpIHRoaXMudXNlckxpc3QudW5zaGlmdChkYXRhLnJlY29yZWQpOwogICAgICAgIH0KICAgICAgfSk7CiAgICAgIHdzLiRvbignbXNzYWdlX251bScsIChkYXRhKSA9PiB7CiAgICAgICAgaWYgKGRhdGEucmVjb3JlZC5pZCkgewogICAgICAgICAgbGV0IHN0YXR1cyA9IGZhbHNlOwogICAgICAgICAgdGhhdC51c2VyTGlzdC5mb3JFYWNoKChlbCwgaW5kZXgsIGFycikgPT4gewogICAgICAgICAgICBpZiAoZGF0YS5yZWNvcmVkLmlkID09IGVsLmlkKSB7CiAgICAgICAgICAgICAgc3RhdHVzID0gdHJ1ZTsKICAgICAgICAgICAgICBpZiAoZGF0YS5yZWNvcmVkLmlzX3RvdXJpc3QgPT0gdGhhdC5oZFRhYkN1cikgewogICAgICAgICAgICAgICAgbGV0IG9sZFZhbCA9IGRhdGEucmVjb3JlZDsKICAgICAgICAgICAgICAgIGFyci5zcGxpY2UoaW5kZXgsIDEpOwogICAgICAgICAgICAgICAgYXJyLnVuc2hpZnQob2xkVmFsKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgICAgaWYgKCFzdGF0dXMpIHsKICAgICAgICAgICAgaWYgKGRhdGEucmVjb3JlZC5pc190b3VyaXN0ID09IHRoaXMuaGRUYWJDdXIpIHRoaXMudXNlckxpc3QudW5zaGlmdChkYXRhLnJlY29yZWQpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoZGF0YS5yZWNvcmVkLmlzX3RvdXJpc3QgIT0gdGhpcy5oZFRhYkN1ciAmJiBkYXRhLnJlY29yZWQuaWQpIHsKICAgICAgICAgIHRoaXMuJE5vdGljZS5pbmZvKHsKICAgICAgICAgICAgdGl0bGU6IHRoaXMuaGRUYWJDdXIgPyAn55So5oi35Y+R5p2l5raI5oGv5ZWm77yBJyA6ICfmuLjlrqLlj5HmnaXmtojmga/llabvvIEnLAogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0pOwogICAgdGhpcy5idXMuJG9uKCdjaGFuZ2UnLCAoZGF0YSkgPT4gewogICAgICB0aGlzLm5pY2tuYW1lID0gZGF0YTsKICAgIH0pOwogICAgdGhpcy5nZXRMaXN0KCk7CiAgfSwKICBtZXRob2RzOiB7CiAgICAvL+WIh+aNogogICAgY2hhbmdlVGFiKGl0ZW0pIHsKICAgICAgaWYgKHRoaXMuaGRUYWJDdXIgPT0gaXRlbS5rZXkpIHJldHVybjsKICAgICAgdGhpcy5oZFRhYkN1ciA9IGl0ZW0ua2V5OwogICAgICB0aGlzLmlzU2Nyb2xsID0gdHJ1ZTsKICAgICAgdGhpcy5wYWdlID0gMTsKICAgICAgdGhpcy51c2VyTGlzdCA9IFtdOwogICAgICB0aGlzLiRlbWl0KCdjaGFuZ2VUeXBlJywgaXRlbS5rZXkpOwogICAgICB0aGlzLmdldExpc3QoKTsKICAgIH0sCiAgICBnZXRMaXN0KCkgewogICAgICBpZiAoIXRoaXMuaXNTY3JvbGwpIHJldHVybjsKICAgICAgcmVjb3JkKHsKICAgICAgICBuaWNrbmFtZTogdGhpcy5uaWNrbmFtZSwKICAgICAgICBwYWdlOiB0aGlzLnBhZ2UsCiAgICAgICAgbGltaXQ6IHRoaXMubGltaXQsCiAgICAgICAgaXNfdG91cmlzdDogdGhpcy5oZFRhYkN1ciwKICAgICAgfSkudGhlbigocmVzKSA9PiB7CiAgICAgICAgaWYgKHJlcy5kYXRhLmxlbmd0aCA+IDApIHsKICAgICAgICAgIHJlcy5kYXRhWzBdLm1zc2FnZV9udW0gPSAwOwogICAgICAgICAgdGhpcy5pc1Njcm9sbCA9IHJlcy5kYXRhLmxlbmd0aCA+PSB0aGlzLmxpbWl0OwoKICAgICAgICAgIHRoaXMudXNlckxpc3QgPSB0aGlzLnVzZXJMaXN0LmNvbmNhdChyZXMuZGF0YSk7CgogICAgICAgICAgaWYgKHRoaXMucGFnZSA9PSAxICYmIHJlcy5kYXRhLmxlbmd0aCA+IDAgJiYgIXRoaXMuaXNTZWFyY2gpIHsKICAgICAgICAgICAgdGhpcy5jdXJJZCA9IHJlcy5kYXRhWzBdLmlkOwogICAgICAgICAgICB0aGlzLiRlbWl0KCdzZXREYXRhSWQnLCByZXMuZGF0YVswXSk7CiAgICAgICAgICB9CiAgICAgICAgICB0aGlzLnBhZ2UrKzsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy4kZW1pdCgnc2V0RGF0YUlkJywgMCk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCiAgICBjaGFydFJlYWNoQm90dG9tKCkgewogICAgICB0aGlzLmdldExpc3QoKTsKICAgIH0sCiAgICAvLyDpgInmi6nnlKjmiLcKICAgIHNlbGVjdFVzZXIoaXRlbSkgewogICAgICBpZiAodGhpcy5jdXJJZCA9PSBpdGVtLmlkKSByZXR1cm47CiAgICAgIGl0ZW0ubXNzYWdlX251bSA9IDA7CiAgICAgIHRoaXMuY3VySWQgPSBpdGVtLmlkOwogICAgICB0aGlzLiRlbWl0KCdzZXREYXRhSWQnLCBpdGVtKTsKICAgIH0sCiAgICBoYW5kbGVTY3JvbGwodmVydGljYWwsIGhvcml6b250YWwsIG5hdGl2ZUV2ZW50KSB7CiAgICAgIGlmICh2ZXJ0aWNhbC5wcm9jZXNzID09IDEpIHsKICAgICAgICB0aGlzLmdldExpc3QoKTsKICAgICAgfQogICAgfSwKICB9LAp9Owo="},{"version":3,"sources":["chatList.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAiEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"chatList.vue","sourceRoot":"src/pages/kefu/pc/components","sourcesContent":["<template>\n  <div class=\"chatList\">\n    <div class=\"tab-head\">\n      <div\n        class=\"item\"\n        :class=\"{ active: item.key == hdTabCur }\"\n        v-for=\"(item, index) in hdTab\"\n        :key=\"index\"\n        @click=\"changeTab(item)\"\n      >\n        {{ item.title }}\n      </div>\n    </div>\n    <div class=\"scroll-box\">\n      <vue-scroll :ops=\"ops\" @handle-scroll=\"handleScroll\" v-if=\"userList.length > 0\">\n        <div\n          class=\"chat-item\"\n          v-for=\"(item, index) in userList\"\n          :key=\"index\"\n          :class=\"{ active: curId == item.id }\"\n          @click=\"selectUser(item)\"\n        >\n          <div class=\"avatar\">\n            <img v-lazy=\"item.wx_avatar\" alt=\"\" />\n            <div class=\"status\" :class=\"{ off: item.online == 0 }\"></div>\n          </div>\n          <div class=\"user-info\">\n            <div class=\"hd\">\n              <span class=\"name line1\">{{ item.nickname }}</span>\n              <template v-if=\"item.type == 2\">\n                <span class=\"label\">小程序</span>\n              </template>\n              <template v-if=\"item.type == 3\">\n                <span class=\"label H5\">H5</span>\n              </template>\n              <template v-if=\"item.type == 1\">\n                <span class=\"label wechat\">公众号</span>\n              </template>\n              <template v-if=\"item.type == 0\">\n                <span class=\"label pc\">PC端</span>\n              </template>\n            </div>\n            <div class=\"bd line1\">\n              <template v-if=\"item.message_type <= 2\">{{ item.message }}</template>\n              <template v-if=\"item.message_type == 3\">[图片]</template>\n              <template v-if=\"item.message_type == 5\">[商品]</template>\n              <template v-if=\"item.message_type == 6\">[订单]</template>\n            </div>\n          </div>\n          <div class=\"right-box\">\n            <div class=\"time\">{{ item.update_time | toDay }}</div>\n            <div class=\"num\">\n              <Badge :count=\"item.mssage_num\">\n                <a href=\"#\" class=\"demo-badge\"></a>\n              </Badge>\n            </div>\n          </div>\n        </div>\n      </vue-scroll>\n      <empty v-else msg=\"暂无用户列表\" status=\"1\"></empty>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { Socket } from '@/libs/socket';\nimport dayjs from 'dayjs';\nimport { record } from '@/api/kefu';\nimport { HappyScroll } from 'vue-happy-scroll';\nimport empty from '../../components/empty';\nimport { forEach } from '../../../../libs/tools';\nexport default {\n  name: 'chatList',\n  props: {\n    userOnline: {\n      type: Object,\n      default: function () {\n        return {};\n      },\n    },\n    newRecored: {\n      type: Object,\n      default: function () {\n        return {};\n      },\n    },\n    searchData: {\n      type: String,\n      default: '',\n    },\n  },\n  components: {\n    HappyScroll,\n    empty,\n  },\n  watch: {\n    userOnline: {\n      handler(nVal, oVal) {\n        if (nVal.hasOwnProperty('to_uid')) {\n          this.userList.forEach((el, index) => {\n            if (el.to_uid == nVal.to_uid) {\n              el.online = nVal.online;\n              if (nVal.online == 1) {\n                this.$Notice.info({\n                  title: '上线通知',\n                  desc: `${el.nickname}上线`,\n                });\n              }\n            }\n          });\n        }\n      },\n      deep: true,\n    },\n    searchData: {\n      handler(nVal, oVal) {\n        if (nVal != oVal) {\n          this.nickname = nVal;\n          this.page = 1;\n          this.isScroll = true;\n          this.userList = [];\n          this.isSearch = true;\n          this.getList();\n        }\n      },\n      deep: true,\n    },\n  },\n  data() {\n    return {\n      hdTabCur: 0,\n      hdTab: [\n        {\n          key: 0,\n          title: '用户列表',\n        },\n        {\n          key: 1,\n          title: '游客列表',\n        },\n      ],\n      userList: [],\n      curId: '',\n      page: 1,\n      limit: 15,\n      isScroll: true,\n      nickname: '',\n      isSearch: false,\n      ops: {\n        vuescroll: {\n          mode: 'native',\n          enable: false,\n          tips: {\n            deactive: 'Push to Load',\n            active: 'Release to Load',\n            start: 'Loading...',\n            beforeDeactive: 'Load Successfully!',\n          },\n          auto: false,\n          autoLoadDistance: 0,\n          pullRefresh: {\n            enable: false,\n          },\n          pushLoad: {\n            enable: true,\n            auto: true,\n            autoLoadDistance: 10,\n          },\n        },\n        bar: {\n          background: '#393232',\n          opacity: '.5',\n          size: '5px',\n        },\n      },\n    };\n  },\n  filters: {\n    toDay: function (value) {\n      if (!value) return '';\n      return dayjs.unix(value).format('M月D日 HH:mm');\n    },\n  },\n  mounted() {\n    let that = this;\n    Socket.then((ws) => {\n      //用户转接\n      ws.$on('transfer', (data) => {\n        let status = false;\n        that.userList.forEach((el, index, arr) => {\n          if (data.recored.id == el.id) {\n            status = true;\n            if (data.recored.is_tourist == that.hdTabCur) {\n              let oldVal = data.recored;\n              arr.splice(index, 1);\n\n              if (index == 0) {\n                this.$emit('setDataId', oldVal);\n                oldVal.mssage_num = 0;\n              }\n              arr.unshift(oldVal);\n            }\n            this.$Notice.info({\n              title: '您有一条转接消息！',\n            });\n          }\n        });\n        if (!status) {\n          if (data.recored.is_tourist == this.hdTabCur) this.userList.unshift(data.recored);\n        }\n      });\n      ws.$on('mssage_num', (data) => {\n        if (data.recored.id) {\n          let status = false;\n          that.userList.forEach((el, index, arr) => {\n            if (data.recored.id == el.id) {\n              status = true;\n              if (data.recored.is_tourist == that.hdTabCur) {\n                let oldVal = data.recored;\n                arr.splice(index, 1);\n                arr.unshift(oldVal);\n              }\n            }\n          });\n          if (!status) {\n            if (data.recored.is_tourist == this.hdTabCur) this.userList.unshift(data.recored);\n          }\n        }\n        if (data.recored.is_tourist != this.hdTabCur && data.recored.id) {\n          this.$Notice.info({\n            title: this.hdTabCur ? '用户发来消息啦！' : '游客发来消息啦！',\n          });\n        }\n      });\n    });\n    this.bus.$on('change', (data) => {\n      this.nickname = data;\n    });\n    this.getList();\n  },\n  methods: {\n    //切换\n    changeTab(item) {\n      if (this.hdTabCur == item.key) return;\n      this.hdTabCur = item.key;\n      this.isScroll = true;\n      this.page = 1;\n      this.userList = [];\n      this.$emit('changeType', item.key);\n      this.getList();\n    },\n    getList() {\n      if (!this.isScroll) return;\n      record({\n        nickname: this.nickname,\n        page: this.page,\n        limit: this.limit,\n        is_tourist: this.hdTabCur,\n      }).then((res) => {\n        if (res.data.length > 0) {\n          res.data[0].mssage_num = 0;\n          this.isScroll = res.data.length >= this.limit;\n\n          this.userList = this.userList.concat(res.data);\n\n          if (this.page == 1 && res.data.length > 0 && !this.isSearch) {\n            this.curId = res.data[0].id;\n            this.$emit('setDataId', res.data[0]);\n          }\n          this.page++;\n        } else {\n          this.$emit('setDataId', 0);\n        }\n      });\n    },\n    chartReachBottom() {\n      this.getList();\n    },\n    // 选择用户\n    selectUser(item) {\n      if (this.curId == item.id) return;\n      item.mssage_num = 0;\n      this.curId = item.id;\n      this.$emit('setDataId', item);\n    },\n    handleScroll(vertical, horizontal, nativeEvent) {\n      if (vertical.process == 1) {\n        this.getList();\n      }\n    },\n  },\n};\n</script>\n\n<style lang=\"stylus\" scoped>\n.chatList\n    display flex\n    flex-direction column\n    width 320px\n    height 742px\n    border-right 1px solid #ECECEC\n    .tab-head\n        display flex\n        align-items center\n        justify-content space-between\n        height 50px\n        flex-shrink 0\n        padding 0 52px\n        font-size 14px\n        color #000000\n        .item\n            position relative\n            cursor pointer\n            &:after\n                display none\n                content ' '\n                position absolute\n                left 50%\n                bottom -15px\n                transform translateX(-50%)\n                height 2px\n                width 100%\n                background #1890FF\n            &.active\n                color #1890FF\n                &:after\n                    display block\n\n    .scroll-box\n        flex 1\n        height 500px\n        overflow hidden\n    .chat-item\n        display flex\n        align-items center\n        justify-content space-between\n        padding 12px 10px\n        height 74px\n        box-sizing border-box\n        border-left 3px solid transparent\n        cursor pointer\n        &.active\n            background #EFF0F1\n            border-left 3px solid #1890FF\n        .avatar\n            position relative\n            width 40px\n            height 40px\n            img\n                display block\n                width 100%\n                height 100%\n                border-radius 50%\n            .status\n                position absolute\n                right 3px\n                bottom 0\n                width 8px\n                height 8px\n                background #48D452\n                border 1px solid #fff\n                border-radius 50%\n                &.off\n                    background #999999\n        .user-info\n            width 155px\n            margin-left 12px\n            margin-top: 5px;\n            font-size 16px\n            .hd\n                display flex\n                align-items center\n                color: rgba(0, 0, 0, 0.65);\n                .name\n                    max-width 67%\n                .label\n                    margin-left 5px\n                    color #3875EA\n                    font-size 12px\n                    background #D8E5FF\n                    border-radius 2px\n                    padding 1px 5px\n                    &.H5\n                        background #FAF1D0\n                        color #DC9A04\n                    &.wechat\n                        background: rgba(64, 194, 73, 0.16);\n                        color #40C249\n                    &.pc\n                        background: rgba(100, 64, 194, 0.16);;\n                        color #6440C2\n            .bd\n                margin-top 3px\n                font-size 12px\n                color #8E959E\n        .right-box\n            position relative\n            flex 1\n            display flex\n            flex-direction column\n            align-items flex-end\n            color #8E959E\n            .num\n                margin-right 12px\n.chart-scroll\n    margin-top -10px\n</style>\n"]}]}