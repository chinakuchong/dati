{"remainingRequest":"/Volumes/mac/webwork/2023/dati/template/admin/node_modules/vue-loader/lib/index.js??vue-loader-options!/Volumes/mac/webwork/2023/dati/template/admin/node_modules/iview-loader/index.js??ref--0-2!/Volumes/mac/webwork/2023/dati/template/admin/src/pages/system/crontab/index.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Volumes/mac/webwork/2023/dati/template/admin/src/pages/system/crontab/index.vue","mtime":1689324015274},{"path":"/Volumes/mac/webwork/2023/dati/template/admin/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Volumes/mac/webwork/2023/dati/template/admin/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Volumes/mac/webwork/2023/dati/template/admin/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Volumes/mac/webwork/2023/dati/template/admin/node_modules/vue-loader/lib/index.js","mtime":499162500000},{"path":"/Volumes/mac/webwork/2023/dati/template/admin/node_modules/iview-loader/index.js","mtime":1570440814000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7IHRpbWVySW5kZXgsIHNob3dUaW1lciB9IGZyb20gJ0AvYXBpL3N5c3RlbSc7CmltcG9ydCBjcmVhdFRhc2sgZnJvbSAnLi9jcmVhdGVNb2RhbC52dWUnOwpleHBvcnQgZGVmYXVsdCB7CiAgbmFtZTogJ3N5c3RlbV9jcm9udGFiJywKICBjb21wb25lbnRzOiB7IGNyZWF0VGFzayB9LAogIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICBsb2FkaW5nOiBmYWxzZSwKICAgICAgY29sdW1uczogWwogICAgICAgIHsKICAgICAgICAgIHRpdGxlOiAn5ZCN56ewJywKICAgICAgICAgIGtleTogJ25hbWUnLAogICAgICAgICAgbWluV2lkdGg6IDE1MCwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgIHRpdGxlOiAn5Lu75Yqh6K+05piOJywKICAgICAgICAgIGtleTogJ2NvbnRlbnQnLAogICAgICAgICAgbWluV2lkdGg6IDEyMCwKICAgICAgICB9LAogICAgICAgIC8vIHsKICAgICAgICAvLyAgIHRpdGxlOiAn5pyA5ZCO5omn6KGM5pe26Ze0JywKICAgICAgICAvLyAgIGtleTogJ2xhc3RfZXhlY3V0aW9uX3RpbWUnLAogICAgICAgIC8vICAgbWluV2lkdGg6IDEyMCwKICAgICAgICAvLyB9LAogICAgICAgIC8vIHsKICAgICAgICAvLyAgIHRpdGxlOiAn5LiL5qyh5omn6KGM5pe26Ze0JywKICAgICAgICAvLyAgIGtleTogJ25leHRfZXhlY3V0aW9uX3RpbWUnLAogICAgICAgIC8vICAgbWluV2lkdGg6IDEyMCwKICAgICAgICAvLyB9LAogICAgICAgIHsKICAgICAgICAgIHRpdGxlOiAn5omn6KGM5ZGo5pyfJywKICAgICAgICAgIHNsb3Q6ICdleGVjdXRpb25fY3ljbGUnLAogICAgICAgICAgbWluV2lkdGg6IDE2MCwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgIHRpdGxlOiAn5piv5ZCm5byA5ZCvJywKICAgICAgICAgIHNsb3Q6ICdpc19vcGVuJywKICAgICAgICAgIG1pbldpZHRoOiAxMDAsCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICB0aXRsZTogJ+aTjeS9nCcsCiAgICAgICAgICBzbG90OiAnYWN0aW9uJywKICAgICAgICAgIGFsaWduOiAnY2VudGVyJywKICAgICAgICAgIG1pbldpZHRoOiAxMDAsCiAgICAgICAgfSwKICAgICAgXSwKICAgICAgdGFibGVEYXRhOiBbXSwKICAgICAgcGFnZTogMSwKICAgICAgbGltaXQ6IDE1LAogICAgICB0b3RhbDogMSwKICAgIH07CiAgfSwKICBjcmVhdGVkKCkgewogICAgdGhpcy5nZXRMaXN0KCk7CiAgfSwKICBtZXRob2RzOiB7CiAgICB0YXNrVHJpcChyb3cpIHsKICAgICAgc3dpdGNoIChyb3cudHlwZSkgewogICAgICAgIGNhc2UgMToKICAgICAgICAgIHJldHVybiBg5q+P6ZqUJHtyb3cuc2Vjb25kfeenkuaJp+ihjOS4gOasoWA7CiAgICAgICAgY2FzZSAyOgogICAgICAgICAgcmV0dXJuIGDmr4/pmpQke3Jvdy5taW51dGV95YiG6ZKf5omn6KGM5LiA5qyhYDsKICAgICAgICBjYXNlIDM6CiAgICAgICAgICByZXR1cm4gYOavj+malCR7cm93LmhvdXJ95bCP5pe25omn6KGM5LiA5qyhYDsKICAgICAgICBjYXNlIDQ6CiAgICAgICAgICByZXR1cm4gYOavj+malCR7cm93LmRheX3lpKnmiafooYzkuIDmrKFgOwogICAgICAgIGNhc2UgNToKICAgICAgICAgIHJldHVybiBg5q+P5aSpJHtyb3cuaG91cn3ml7Yke3Jvdy5taW51dGV95YiGJHtyb3cuc2Vjb25kfeenkuaJp+ihjOS4gOasoWA7CiAgICAgICAgY2FzZSA2OgogICAgICAgICAgcmV0dXJuIGDmr4/kuKrmmJ/mnJ8ke3Jvdy53ZWVrfeeahCR7cm93LmhvdXJ95pe2JHtyb3cubWludXRlfeWIhiR7cm93LnNlY29uZH3np5LmiafooYzkuIDmrKFgOwogICAgICAgIGNhc2UgNzoKICAgICAgICAgIHJldHVybiBg5q+P5pyIJHtyb3cuZGF5feaXpeeahCR7cm93LmhvdXJ95pe2JHtyb3cubWludXRlfeWIhiR7cm93LnNlY29uZH3np5LmiafooYzkuIDmrKFgOwogICAgICB9CiAgICB9LAogICAgLy8g5YiX6KGoCiAgICBnZXRMaXN0KCkgewogICAgICB0aGlzLmxvYWRpbmcgPSB0cnVlOwogICAgICB0aW1lckluZGV4KHsKICAgICAgICBwYWdlOiB0aGlzLnBhZ2UsCiAgICAgICAgbGltaXQ6IHRoaXMubGltaXQsCiAgICAgIH0pCiAgICAgICAgLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgdGhpcy5sb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICBsZXQgeyBjb3VudCwgbGlzdCB9ID0gcmVzLmRhdGE7CiAgICAgICAgICB0aGlzLnRvdGFsID0gY291bnQ7CiAgICAgICAgICB0aGlzLnRhYmxlRGF0YSA9IGxpc3Q7CiAgICAgICAgfSkKICAgICAgICAuY2F0Y2goKHJlcykgPT4gewogICAgICAgICAgdGhpcy5sb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICB0aGlzLiRNZXNzYWdlLmVycm9yKHJlcy5tc2cpOwogICAgICAgIH0pOwogICAgfSwKICAgIGFkZFRhc2soKSB7CiAgICAgIHRoaXMuJHJlZnMuYWRkVGFzay5tb2RhbCA9IHRydWU7CiAgICB9LAogICAgZWRpdChpZCkgewogICAgICB0aGlzLiRyZWZzLmFkZFRhc2sudGltZXJJbmZvKGlkKTsKICAgIH0sCiAgICAvLyDliKDpmaQKICAgIGhhbmRsZURlbGV0ZShyb3csIHRpdCwgbnVtKSB7CiAgICAgIGxldCBkZWxmcm9tRGF0YSA9IHsKICAgICAgICB0aXRsZTogdGl0LAogICAgICAgIG51bTogbnVtLAogICAgICAgIHVybDogYHN5c3RlbS9jcm9udGFiL2RlbC8ke3Jvdy5pZH1gLAogICAgICAgIG1ldGhvZDogJ2RlbGV0ZScsCiAgICAgICAgaWRzOiAnJywKICAgICAgfTsKICAgICAgdGhpcy4kbW9kYWxTdXJlKGRlbGZyb21EYXRhKQogICAgICAgIC50aGVuKChyZXMpID0+IHsKICAgICAgICAgIHRoaXMuJE1lc3NhZ2Uuc3VjY2VzcyhyZXMubXNnKTsKICAgICAgICAgIHRoaXMuZ2V0TGlzdCgpOwogICAgICAgIH0pCiAgICAgICAgLmNhdGNoKChyZXMpID0+IHsKICAgICAgICAgIHRoaXMuJE1lc3NhZ2UuZXJyb3IocmVzLm1zZyk7CiAgICAgICAgfSk7CiAgICB9LAogICAgLy8g5piv5ZCm5byA5ZCvCiAgICBoYW5kbGVDaGFuZ2UoeyBpZCwgaXNfb3BlbiB9KSB7CiAgICAgIHNob3dUaW1lcihpZCwgaXNfb3BlbikKICAgICAgICAudGhlbigocmVzKSA9PiB7CiAgICAgICAgICB0aGlzLiRNZXNzYWdlLnN1Y2Nlc3MocmVzLm1zZyk7CiAgICAgICAgICB0aGlzLmdldExpc3QoKTsKICAgICAgICB9KQogICAgICAgIC5jYXRjaCgocmVzKSA9PiB7CiAgICAgICAgICB0aGlzLiRNZXNzYWdlLmVycm9yKHJlcy5tc2cpOwogICAgICAgIH0pOwogICAgfSwKICAgIHBhZ2VDaGFuZ2UoaW5kZXgpIHsKICAgICAgdGhpcy5wYWdlID0gaW5kZXg7CiAgICAgIHRoaXMuZ2V0TGlzdCgpOwogICAgfSwKICB9LAp9Owo="},{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAmCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/pages/system/crontab","sourcesContent":["<template>\n  <Card :bordered=\"false\" dis-hover>\n    <Alert closable=\"true\">\n      <template slot=\"desc\">\n        启动定时任务两种方式：<br />\n        1、使用命令启动：php think timer start\n        --d；如果更改了执行周期、编辑是否开启、删除定时任务需要重新启动下定时任务确保生效；<br />\n        2、使用接口触发定时任务，建议每分钟调用一次，接口地址 https://您的域名/api/crontab/run\n      </template>\n    </Alert>\n    <Button type=\"primary\" @click=\"addTask\">添加定时任务</Button>\n    <Table :columns=\"columns\" :data=\"tableData\" :loading=\"loading\" class=\"ivu-mt\">\n      <template slot-scope=\"{ row }\" slot=\"execution_cycle\">\n        <span>{{ taskTrip(row) }}</span>\n      </template>\n      <template slot-scope=\"{ row }\" slot=\"is_open\">\n        <i-switch v-model=\"row.is_open\" :true-value=\"1\" :false-value=\"0\" size=\"large\" @on-change=\"handleChange(row)\">\n          <span slot=\"open\">开启</span>\n          <span slot=\"close\">关闭</span>\n        </i-switch>\n      </template>\n      <template slot-scope=\"{ row }\" slot=\"action\">\n        <a @click=\"edit(row.id)\">编辑</a>\n        <Divider type=\"vertical\" />\n        <a @click=\"handleDelete(row, '删除秒杀商品', index)\">删除</a>\n      </template>\n    </Table>\n    <div class=\"acea-row row-right page\">\n      <Page :total=\"total\" :current=\"page\" show-elevator show-total @on-change=\"pageChange\" :page-size=\"limit\" />\n    </div>\n    <creatTask ref=\"addTask\" @submitAsk=\"getList\"></creatTask>\n  </Card>\n</template>\n\n<script>\nimport { timerIndex, showTimer } from '@/api/system';\nimport creatTask from './createModal.vue';\nexport default {\n  name: 'system_crontab',\n  components: { creatTask },\n  data() {\n    return {\n      loading: false,\n      columns: [\n        {\n          title: '名称',\n          key: 'name',\n          minWidth: 150,\n        },\n        {\n          title: '任务说明',\n          key: 'content',\n          minWidth: 120,\n        },\n        // {\n        //   title: '最后执行时间',\n        //   key: 'last_execution_time',\n        //   minWidth: 120,\n        // },\n        // {\n        //   title: '下次执行时间',\n        //   key: 'next_execution_time',\n        //   minWidth: 120,\n        // },\n        {\n          title: '执行周期',\n          slot: 'execution_cycle',\n          minWidth: 160,\n        },\n        {\n          title: '是否开启',\n          slot: 'is_open',\n          minWidth: 100,\n        },\n        {\n          title: '操作',\n          slot: 'action',\n          align: 'center',\n          minWidth: 100,\n        },\n      ],\n      tableData: [],\n      page: 1,\n      limit: 15,\n      total: 1,\n    };\n  },\n  created() {\n    this.getList();\n  },\n  methods: {\n    taskTrip(row) {\n      switch (row.type) {\n        case 1:\n          return `每隔${row.second}秒执行一次`;\n        case 2:\n          return `每隔${row.minute}分钟执行一次`;\n        case 3:\n          return `每隔${row.hour}小时执行一次`;\n        case 4:\n          return `每隔${row.day}天执行一次`;\n        case 5:\n          return `每天${row.hour}时${row.minute}分${row.second}秒执行一次`;\n        case 6:\n          return `每个星期${row.week}的${row.hour}时${row.minute}分${row.second}秒执行一次`;\n        case 7:\n          return `每月${row.day}日的${row.hour}时${row.minute}分${row.second}秒执行一次`;\n      }\n    },\n    // 列表\n    getList() {\n      this.loading = true;\n      timerIndex({\n        page: this.page,\n        limit: this.limit,\n      })\n        .then((res) => {\n          this.loading = false;\n          let { count, list } = res.data;\n          this.total = count;\n          this.tableData = list;\n        })\n        .catch((res) => {\n          this.loading = false;\n          this.$Message.error(res.msg);\n        });\n    },\n    addTask() {\n      this.$refs.addTask.modal = true;\n    },\n    edit(id) {\n      this.$refs.addTask.timerInfo(id);\n    },\n    // 删除\n    handleDelete(row, tit, num) {\n      let delfromData = {\n        title: tit,\n        num: num,\n        url: `system/crontab/del/${row.id}`,\n        method: 'delete',\n        ids: '',\n      };\n      this.$modalSure(delfromData)\n        .then((res) => {\n          this.$Message.success(res.msg);\n          this.getList();\n        })\n        .catch((res) => {\n          this.$Message.error(res.msg);\n        });\n    },\n    // 是否开启\n    handleChange({ id, is_open }) {\n      showTimer(id, is_open)\n        .then((res) => {\n          this.$Message.success(res.msg);\n          this.getList();\n        })\n        .catch((res) => {\n          this.$Message.error(res.msg);\n        });\n    },\n    pageChange(index) {\n      this.page = index;\n      this.getList();\n    },\n  },\n};\n</script>\n\n<style lang=\"stylus\" scoped>\n.ivu-mt {\n  padding-top:10px\n}\n</style>\n"]}]}