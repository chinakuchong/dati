{"remainingRequest":"/Volumes/mac/webwork/2023/dati/template/admin/node_modules/vue-loader/lib/index.js??vue-loader-options!/Volumes/mac/webwork/2023/dati/template/admin/node_modules/iview-loader/index.js??ref--0-2!/Volumes/mac/webwork/2023/dati/template/admin/src/pages/app/routine/download/index.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Volumes/mac/webwork/2023/dati/template/admin/src/pages/app/routine/download/index.vue","mtime":1689324015195},{"path":"/Volumes/mac/webwork/2023/dati/template/admin/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Volumes/mac/webwork/2023/dati/template/admin/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Volumes/mac/webwork/2023/dati/template/admin/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Volumes/mac/webwork/2023/dati/template/admin/node_modules/vue-loader/lib/index.js","mtime":499162500000},{"path":"/Volumes/mac/webwork/2023/dati/template/admin/node_modules/iview-loader/index.js","mtime":1570440814000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7IHJvdXRpbmVEb3dubG9hZCwgcm91dGluZUluZm8gfSBmcm9tICdAL2FwaS9hcHAnOwppbXBvcnQgeyBtYXBTdGF0ZSB9IGZyb20gJ3Z1ZXgnOwppbXBvcnQgeyBmb3JtYXREYXRlIH0gZnJvbSAnQC91dGlscy92YWxpZGF0ZSc7CmV4cG9ydCBkZWZhdWx0IHsKICBuYW1lOiAncm91dGluZVRlbXBsYXRlJywKICBmaWx0ZXJzOiB7CiAgICBmb3JtYXREYXRlKHRpbWUpIHsKICAgICAgaWYgKHRpbWUgIT09IDApIHsKICAgICAgICBsZXQgZGF0ZSA9IG5ldyBEYXRlKHRpbWUgKiAxMDAwKTsKICAgICAgICByZXR1cm4gZm9ybWF0RGF0ZShkYXRlLCAneXl5eS1NTS1kZCBoaDptbScpOwogICAgICB9CiAgICB9LAogIH0sCiAgZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIGdyaWQ6IHsKICAgICAgICB4bDogNywKICAgICAgICBsZzogNywKICAgICAgICBtZDogMTIsCiAgICAgICAgc206IDI0LAogICAgICAgIHhzOiAyNCwKICAgICAgfSwKICAgICAgaWZyYW1lVXJsOiBgJHtsb2NhdGlvbi5vcmlnaW59L3BhZ2VzL2luZGV4L2luZGV4P21kVHlwZT1pZnJhbWVXaW5kb3dgLAogICAgICBpc19saXZlOiAxLAogICAgICBwYWdlRGF0YTogewogICAgICAgIGNvZGU6ICcnLAogICAgICAgIHJvdXRpbmVfbmFtZTogJycsCiAgICAgICAgaGVscDogJycsCiAgICAgICAgYXBwSWQ6ICcxJywKICAgICAgfSwKICAgIH07CiAgfSwKICBjcmVhdGVkKCkgewogICAgcm91dGluZUluZm8oKS50aGVuKChyZXMpID0+IHsKICAgICAgdGhpcy5wYWdlRGF0YSA9IHJlcy5kYXRhOwogICAgfSk7CiAgfSwKICB3YXRjaDogewogICAgJHJvdXRlKHRvLCBmcm9tKSB7fSwKICB9LAogIGNvbXB1dGVkOiB7CiAgICAuLi5tYXBTdGF0ZSgnbWVkaWEnLCBbJ2lzTW9iaWxlJ10pLAogICAgbGFiZWxXaWR0aCgpIHsKICAgICAgcmV0dXJuIHRoaXMuaXNNb2JpbGUgPyB1bmRlZmluZWQgOiA4MDsKICAgIH0sCiAgICBsYWJlbFBvc2l0aW9uKCkgewogICAgICByZXR1cm4gdGhpcy5pc01vYmlsZSA/ICd0b3AnIDogJ2xlZnQnOwogICAgfSwKICB9LAogIG1ldGhvZHM6IHsKICAgIGRvd25Mb2FkKCkgewogICAgICByb3V0aW5lRG93bmxvYWQoewogICAgICAgIGlzX2xpdmU6IHRoaXMuaXNfbGl2ZSwKICAgICAgfSkKICAgICAgICAudGhlbigocmVzKSA9PiB7CiAgICAgICAgICB3aW5kb3cub3BlbihyZXMuZGF0YS51cmwpOwogICAgICAgIH0pCiAgICAgICAgLmNhdGNoKChlcnIpID0+IHsKICAgICAgICAgIHRoaXMuJE1lc3NhZ2Uud2FybmluZyhlcnIubXNnKTsKICAgICAgICB9KTsKICAgIH0sCiAgICBkb3duTG9hZENvZGUodXJsKSB7CiAgICAgIGlmICghdXJsKSByZXR1cm4gdGhpcy4kTWVzc2FnZS53YXJuaW5nKCfmmoLml6DlsI/nqIvluo/noIEnKTsKICAgICAgdmFyIGltYWdlID0gbmV3IEltYWdlKCk7CiAgICAgIGltYWdlLnNyYyA9IHVybDsKICAgICAgLy8g6Kej5Yaz6Leo5Z+fIENhbnZhcyDmsaHmn5Ppl67popgKICAgICAgaW1hZ2Uuc2V0QXR0cmlidXRlKCdjcm9zc09yaWdpbicsICdhbm9ueW1vdXMnKTsKICAgICAgaW1hZ2Uub25sb2FkID0gZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBjYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKTsKICAgICAgICBjYW52YXMud2lkdGggPSBpbWFnZS53aWR0aDsKICAgICAgICBjYW52YXMuaGVpZ2h0ID0gaW1hZ2UuaGVpZ2h0OwogICAgICAgIHZhciBjb250ZXh0ID0gY2FudmFzLmdldENvbnRleHQoJzJkJyk7CiAgICAgICAgY29udGV4dC5kcmF3SW1hZ2UoaW1hZ2UsIDAsIDAsIGltYWdlLndpZHRoLCBpbWFnZS5oZWlnaHQpOwogICAgICAgIHZhciB1cmwgPSBjYW52YXMudG9EYXRhVVJMKCk7IC8v5b6X5Yiw5Zu+54mH55qEYmFzZTY057yW56CB5pWw5o2uCiAgICAgICAgdmFyIGEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7IC8vIOeUn+aIkOS4gOS4qmHlhYPntKAKICAgICAgICB2YXIgZXZlbnQgPSBuZXcgTW91c2VFdmVudCgnY2xpY2snKTsgLy8g5Yib5bu65LiA5Liq5Y2V5Ye75LqL5Lu2CiAgICAgICAgYS5kb3dubG9hZCA9IG5hbWUgfHwgJ3Bob3RvJzsgLy8g6K6+572u5Zu+54mH5ZCN56ewCiAgICAgICAgYS5ocmVmID0gdXJsOyAvLyDlsIbnlJ/miJDnmoRVUkzorr7nva7kuLphLmhyZWblsZ7mgKcKICAgICAgICBhLmRpc3BhdGNoRXZlbnQoZXZlbnQpOyAvLyDop6blj5Fh55qE5Y2V5Ye75LqL5Lu2CiAgICAgIH07CiAgICB9LAogIH0sCn07Cg=="},{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAkEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/pages/app/routine/download","sourcesContent":["<template>\n  <div>\n    <div class=\"i-layout-page-header header-title\">\n      <span class=\"ivu-page-header-title\">{{ $route.meta.title }}</span>\n    </div>\n    <Card :bordered=\"false\" dis-hover class=\"ivu-mt\">\n      <div class=\"flex-wrapper\">\n        <!-- :src=\"iframeUrl\" -->\n        <div>\n          <iframe class=\"iframe-box\" :src=\"iframeUrl\" frameborder=\"0\" ref=\"iframe\"></iframe>\n          <div class=\"mask\"></div>\n        </div>\n\n        <div class=\"right\">\n          <div class=\"content\">\n            <div class=\"content-box title\">\n              <div class=\"line\"></div>\n              <div class=\"right title\">小程序设置</div>\n            </div>\n            <Alert v-if=\"!pageData.appId && !pageData.code\">\n              <template slot=\"desc\">\n                您尚未配置小程序信息，请<router-link :to=\"{ path: $routeProStr + '/setting/system_config_retail/3/7' }\"\n                  >立即设置</router-link\n                ></template\n              >\n            </Alert>\n            <div class=\"content-box\">\n              <div class=\"left\">小程序名称：</div>\n              <div class=\"right\">{{ pageData.routine_name || '未命名' }}</div>\n            </div>\n            <div class=\"content-box\">\n              <div class=\"left\">小程序码：</div>\n              <div class=\"right\">\n                <Button type=\"primary\" @click=\"downLoadCode(pageData.code)\">下载小程序码</Button>\n              </div>\n            </div>\n            <div class=\"content-box\">\n              <div class=\"left\">小程序包：</div>\n              <div class=\"right\">\n                <span>是否已开通小程序直播</span>\n                <RadioGroup class=\"rad\" size=\"large\" v-model=\"is_live\">\n                  <Radio :label=\"0\">未开通</Radio>\n                  <Radio :label=\"1\">已开通</Radio>\n                </RadioGroup>\n              </div>\n            </div>\n            <div class=\"content-box last\">\n              <div class=\"left\"></div>\n              <div class=\"right\">\n                <div>\n                  请谨慎选择是否有开通小程序直播功能，否则将影响小程序的发布 可前往\n                  <a :href=\"pageData.help\" target=\"_blank\">帮助文档</a>\n                  查看如何开通直播功能\n                </div>\n\n                <Button class=\"mt10\" type=\"primary\" @click=\"downLoad()\">下载小程序包</Button>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </Card>\n  </div>\n</template>\n\n<script>\nimport { routineDownload, routineInfo } from '@/api/app';\nimport { mapState } from 'vuex';\nimport { formatDate } from '@/utils/validate';\nexport default {\n  name: 'routineTemplate',\n  filters: {\n    formatDate(time) {\n      if (time !== 0) {\n        let date = new Date(time * 1000);\n        return formatDate(date, 'yyyy-MM-dd hh:mm');\n      }\n    },\n  },\n  data() {\n    return {\n      grid: {\n        xl: 7,\n        lg: 7,\n        md: 12,\n        sm: 24,\n        xs: 24,\n      },\n      iframeUrl: `${location.origin}/pages/index/index?mdType=iframeWindow`,\n      is_live: 1,\n      pageData: {\n        code: '',\n        routine_name: '',\n        help: '',\n        appId: '1',\n      },\n    };\n  },\n  created() {\n    routineInfo().then((res) => {\n      this.pageData = res.data;\n    });\n  },\n  watch: {\n    $route(to, from) {},\n  },\n  computed: {\n    ...mapState('media', ['isMobile']),\n    labelWidth() {\n      return this.isMobile ? undefined : 80;\n    },\n    labelPosition() {\n      return this.isMobile ? 'top' : 'left';\n    },\n  },\n  methods: {\n    downLoad() {\n      routineDownload({\n        is_live: this.is_live,\n      })\n        .then((res) => {\n          window.open(res.data.url);\n        })\n        .catch((err) => {\n          this.$Message.warning(err.msg);\n        });\n    },\n    downLoadCode(url) {\n      if (!url) return this.$Message.warning('暂无小程序码');\n      var image = new Image();\n      image.src = url;\n      // 解决跨域 Canvas 污染问题\n      image.setAttribute('crossOrigin', 'anonymous');\n      image.onload = function () {\n        var canvas = document.createElement('canvas');\n        canvas.width = image.width;\n        canvas.height = image.height;\n        var context = canvas.getContext('2d');\n        context.drawImage(image, 0, 0, image.width, image.height);\n        var url = canvas.toDataURL(); //得到图片的base64编码数据\n        var a = document.createElement('a'); // 生成一个a元素\n        var event = new MouseEvent('click'); // 创建一个单击事件\n        a.download = name || 'photo'; // 设置图片名称\n        a.href = url; // 将生成的URL设置为a.href属性\n        a.dispatchEvent(event); // 触发a的单击事件\n      };\n    },\n  },\n};\n</script>\n\n<style scoped lang=\"stylus\">\n.template_sp_box {\n  padding: 5px 0;\n  box-sizing: border-box;\n}\n\n.template_sp {\n  display: block;\n  padding: 2px 0;\n  box-sizing: border-box;\n}\n\n.flex-wrapper {\n  display: flex;\n  border-radius: 10px;\n}\n\n.iframe-box {\n  width: 312px;\n  height: 550px;\n  border-radius: 10px;\n}\n\n.ivu-mt {\n  height: 600px;\n}\n\n.content {\n  padding: 0 20px;\n}\n\n.content > .title {\n  padding-bottom: 26px;\n}\n\n.content-box {\n  display: flex;\n  align-items: center;\n  margin: 20px 20px 0 20px;\n  color: #333;\n}\n\n.content-box.last {\n  margin-top: 0;\n  color: #999999;\n}\n\n.line {\n  width: 3px;\n  height: 16px;\n  background-color: #1890FF;\n  margin-right: 11px;\n}\n\n.content-box .title {\n  font-size: 16px;\n  font-weight: bold;\n}\n\n.content-box > span {\n  color: #F5222D;\n  font-size: 20px;\n}\n\n.content-box .left {\n  width: 100px;\n  text-align: right;\n}\n\n.content-box .right {\n  width: 400px;\n}\n\n.rad {\n  margin-left: 20px;\n}\n\n.mask {\n  position: absolute;\n  left: 0;\n  top: 0;\n  width: 312px;\n  height: 550px;\n  background-color: rgba(0, 0, 0, 0);\n}\n</style>\n"]}]}