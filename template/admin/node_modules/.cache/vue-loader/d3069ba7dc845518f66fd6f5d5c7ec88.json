{"remainingRequest":"/Volumes/mac/webwork/2023/dati/template/admin/node_modules/vue-loader/lib/index.js??vue-loader-options!/Volumes/mac/webwork/2023/dati/template/admin/node_modules/iview-loader/index.js??ref--0-2!/Volumes/mac/webwork/2023/dati/template/admin/src/pages/product/productAttr/addAttr.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Volumes/mac/webwork/2023/dati/template/admin/src/pages/product/productAttr/addAttr.vue","mtime":1689324015247},{"path":"/Volumes/mac/webwork/2023/dati/template/admin/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Volumes/mac/webwork/2023/dati/template/admin/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Volumes/mac/webwork/2023/dati/template/admin/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Volumes/mac/webwork/2023/dati/template/admin/node_modules/vue-loader/lib/index.js","mtime":499162500000},{"path":"/Volumes/mac/webwork/2023/dati/template/admin/node_modules/iview-loader/index.js","mtime":1570440814000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7IG1hcFN0YXRlIH0gZnJvbSAndnVleCc7CmltcG9ydCB7IHJ1bGVBZGRBcGksIHJ1bGVJbmZvQXBpIH0gZnJvbSAnQC9hcGkvcHJvZHVjdCc7CmV4cG9ydCBkZWZhdWx0IHsKICBuYW1lOiAnYWRkQXR0cicsCiAgZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIHNwaW5TaG93OiBmYWxzZSwKICAgICAgbW9kYWxfbG9hZGluZzogZmFsc2UsCiAgICAgIGdyaWQ6IHsKICAgICAgICB4bDogMywKICAgICAgICBsZzogMywKICAgICAgICBtZDogMTIsCiAgICAgICAgc206IDI0LAogICAgICAgIHhzOiAyNCwKICAgICAgfSwKICAgICAgbW9kYWw6IGZhbHNlLAogICAgICBpbmRleDogMSwKICAgICAgcnVsZXM6IHsKICAgICAgICBydWxlX25hbWU6IFt7IHJlcXVpcmVkOiB0cnVlLCBtZXNzYWdlOiAn6K+36L6T5YWl6KeE5qC85ZCN56ewJywgdHJpZ2dlcjogJ2JsdXInIH1dLAogICAgICB9LAogICAgICBmb3JtRHluYW1pYzogewogICAgICAgIHJ1bGVfbmFtZTogJycsCiAgICAgICAgc3BlYzogW10sCiAgICAgIH0sCiAgICAgIGF0dHJzTmFtZTogJycsCiAgICAgIGF0dHJzVmFsOiAnJywKICAgICAgZm9ybUR5bmFtaWNOYW1lRGF0YTogW10sCiAgICAgIGlzQnRuOiBmYWxzZSwKICAgICAgZm9ybUR5bmFtaWNOYW1lOiBbXSwKICAgICAgcmVzdWx0czogW10sCiAgICAgIHJlc3VsdDogW10sCiAgICAgIGlkczogMCwKICAgIH07CiAgfSwKICBjb21wdXRlZDoge30sCiAgbWV0aG9kczogewogICAgb25DYW5jZWwoKSB7CiAgICAgIHRoaXMuaWRzID0gMDsKICAgICAgdGhpcy5jbGVhcigpOwogICAgfSwKICAgIC8vIOa3u+WKoOaMiemSrgogICAgYWRkQnRuKCkgewogICAgICB0aGlzLmlzQnRuID0gdHJ1ZTsKICAgIH0sCiAgICAvLyDor6bmg4UKICAgIGdldElvZm8ocm93KSB7CiAgICAgIHRoaXMuc3BpblNob3cgPSB0cnVlOwogICAgICB0aGlzLmlkcyA9IHJvdy5pZDsKICAgICAgcnVsZUluZm9BcGkocm93LmlkKQogICAgICAgIC50aGVuKChyZXMpID0+IHsKICAgICAgICAgIHRoaXMuZm9ybUR5bmFtaWMgPSByZXMuZGF0YS5pbmZvOwogICAgICAgICAgdGhpcy5zcGluU2hvdyA9IGZhbHNlOwogICAgICAgIH0pCiAgICAgICAgLmNhdGNoKChyZXMpID0+IHsKICAgICAgICAgIHRoaXMuc3BpblNob3cgPSBmYWxzZTsKICAgICAgICAgIHRoaXMuJE1lc3NhZ2UuZXJyb3IocmVzLm1zZyk7CiAgICAgICAgfSk7CiAgICB9LAogICAgLy8g5o+Q5LqkCiAgICBoYW5kbGVTdWJtaXQobmFtZSkgewogICAgICB0aGlzLiRyZWZzW25hbWVdLnZhbGlkYXRlKCh2YWxpZCkgPT4gewogICAgICAgIGlmICh2YWxpZCkgewogICAgICAgICAgaWYgKHRoaXMuZm9ybUR5bmFtaWMuc3BlYy5sZW5ndGggPT09IDApIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuJE1lc3NhZ2Uud2FybmluZygn6K+36Iez5bCR5re75Yqg5LiA5p2h5ZWG5ZOB6KeE5qC877yBJyk7CiAgICAgICAgICB9CiAgICAgICAgICB0aGlzLm1vZGFsX2xvYWRpbmcgPSB0cnVlOwogICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgIHJ1bGVBZGRBcGkodGhpcy5mb3JtRHluYW1pYywgdGhpcy5pZHMpCiAgICAgICAgICAgICAgLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgICAgICAgdGhpcy4kTWVzc2FnZS5zdWNjZXNzKHJlcy5tc2cpOwogICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgIHRoaXMubW9kYWwgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgdGhpcy5tb2RhbF9sb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICAgICAgICB9LCA1MDApOwogICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgIHRoaXMuJGVtaXQoJ2dldExpc3QnKTsKICAgICAgICAgICAgICAgICAgdGhpcy5jbGVhcigpOwogICAgICAgICAgICAgICAgfSwgNjAwKTsKICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgIC5jYXRjaCgocmVzKSA9PiB7CiAgICAgICAgICAgICAgICB0aGlzLm1vZGFsX2xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgIHRoaXMuJE1lc3NhZ2UuZXJyb3IocmVzLm1zZyk7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICB9LCAxMjAwKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAogICAgY2xlYXIoKSB7CiAgICAgIHRoaXMuJHJlZnNbJ2Zvcm1EeW5hbWljJ10ucmVzZXRGaWVsZHMoKTsKICAgICAgdGhpcy5mb3JtRHluYW1pYy5zcGVjID0gW107CiAgICAgIHRoaXMuaXNCdG4gPSBmYWxzZTsKICAgICAgdGhpcy5hdHRyc05hbWUgPSAnJzsKICAgICAgdGhpcy5hdHRyc1ZhbCA9ICcnOwogICAgICB0aGlzLmlkcyA9IDA7CiAgICB9LAogICAgLy8g5Y+W5raICiAgICBvZmZBdHRyTmFtZSgpIHsKICAgICAgdGhpcy5pc0J0biA9IGZhbHNlOwogICAgfSwKICAgIC8vIOWIoOmZpAogICAgaGFuZGxlUmVtb3ZlKGluZGV4KSB7CiAgICAgIHRoaXMuZm9ybUR5bmFtaWMuc3BlYy5zcGxpY2UoaW5kZXgsIDEpOwogICAgfSwKICAgIC8vIOWIoOmZpOWxnuaApwogICAgaGFuZGxlUmVtb3ZlMihpdGVtLCBpbmRleCkgewogICAgICBpdGVtLnNwbGljZShpbmRleCwgMSk7CiAgICB9LAogICAgLy8g5re75Yqg6KeE5YiZ5ZCN56ewCiAgICBjcmVhdGVBdHRyTmFtZSgpIHsKICAgICAgaWYgKHRoaXMuYXR0cnNOYW1lICYmIHRoaXMuYXR0cnNWYWwpIHsKICAgICAgICBsZXQgZGF0YSA9IHsKICAgICAgICAgIHZhbHVlOiB0aGlzLmF0dHJzTmFtZSwKICAgICAgICAgIGRldGFpbDogW3RoaXMuYXR0cnNWYWxdLAogICAgICAgIH07CiAgICAgICAgdGhpcy5mb3JtRHluYW1pYy5zcGVjLnB1c2goZGF0YSk7CiAgICAgICAgdmFyIGhhc2ggPSB7fTsKICAgICAgICB0aGlzLmZvcm1EeW5hbWljLnNwZWMgPSB0aGlzLmZvcm1EeW5hbWljLnNwZWMucmVkdWNlKGZ1bmN0aW9uIChpdGVtLCBuZXh0KSB7CiAgICAgICAgICAvKiBlc2xpbnQtZGlzYWJsZSAqLwogICAgICAgICAgaGFzaFtuZXh0LnZhbHVlXSA/ICcnIDogKGhhc2hbbmV4dC52YWx1ZV0gPSB0cnVlICYmIGl0ZW0ucHVzaChuZXh0KSk7CiAgICAgICAgICByZXR1cm4gaXRlbTsKICAgICAgICB9LCBbXSk7CiAgICAgICAgdGhpcy5hdHRyc05hbWUgPSAnJzsKICAgICAgICB0aGlzLmF0dHJzVmFsID0gJyc7CiAgICAgICAgdGhpcy5pc0J0biA9IGZhbHNlOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuJE1lc3NhZ2Uud2FybmluZygn6K+35re75Yqg6KeE5qC85ZCN56ew5oiW6KeE5qC85YC8Jyk7CiAgICAgIH0KICAgIH0sCiAgICAvLyDmt7vliqDlsZ7mgKcKICAgIGNyZWF0ZUF0dHIobnVtLCBpZHgpIHsKICAgICAgaWYgKG51bSkgewogICAgICAgIHRoaXMuZm9ybUR5bmFtaWMuc3BlY1tpZHhdLmRldGFpbC5wdXNoKG51bSk7CiAgICAgICAgdmFyIGhhc2ggPSB7fTsKICAgICAgICB0aGlzLmZvcm1EeW5hbWljLnNwZWNbaWR4XS5kZXRhaWwgPSB0aGlzLmZvcm1EeW5hbWljLnNwZWNbaWR4XS5kZXRhaWwucmVkdWNlKGZ1bmN0aW9uIChpdGVtLCBuZXh0KSB7CiAgICAgICAgICAvKiBlc2xpbnQtZGlzYWJsZSAqLwogICAgICAgICAgaGFzaFtuZXh0XSA/ICcnIDogKGhhc2hbbmV4dF0gPSB0cnVlICYmIGl0ZW0ucHVzaChuZXh0KSk7CiAgICAgICAgICByZXR1cm4gaXRlbTsKICAgICAgICB9LCBbXSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy4kTWVzc2FnZS53YXJuaW5nKCfor7fmt7vliqDlsZ7mgKcnKTsKICAgICAgfQogICAgfSwKICB9LAp9Owo="},{"version":3,"sources":["addAttr.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA6EA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"addAttr.vue","sourceRoot":"src/pages/product/productAttr","sourcesContent":["<template>\n  <Modal scrollable v-model=\"modal\" @on-cancel=\"onCancel\" title=\"商品规格\" width=\"950\">\n    <Form\n      ref=\"formDynamic\"\n      :model=\"formDynamic\"\n      :rules=\"rules\"\n      class=\"attrFrom\"\n      :label-width=\"110\"\n      label-position=\"right\"\n      @submit.native.prevent\n    >\n      <Row :gutter=\"24\">\n        <Col span=\"24\">\n          <Col span=\"8\" class=\"mb15\">\n            <FormItem label=\"规格模板名称：\" prop=\"rule_name\">\n              <Input placeholder=\"请输入标题名称\" :maxlength=\"20\" v-model.trim=\"formDynamic.rule_name\" />\n            </FormItem>\n          </Col>\n        </Col>\n        <Col span=\"23\" class=\"noForm\" v-for=\"(item, index) in formDynamic.spec\" :key=\"index\">\n          <FormItem>\n            <div class=\"acea-row row-middle\">\n              <span class=\"mr5\">{{ item.value }}</span\n              ><Icon type=\"ios-close-circle\" @click=\"handleRemove(index)\" />\n            </div>\n            <div class=\"rulesBox\">\n              <Tag\n                type=\"dot\"\n                class=\"\"\n                closable\n                color=\"primary\"\n                v-for=\"(j, indexn) in item.detail\"\n                :key=\"indexn\"\n                :name=\"j\"\n                @on-close=\"handleRemove2(item.detail, indexn)\"\n                >{{ j }}</Tag\n              >\n              <Input\n                search\n                enter-button=\"添加\"\n                placeholder=\"请输入属性名称\"\n                v-model.trim=\"item.detail.attrsVal\"\n                @on-search=\"createAttr(item.detail.attrsVal, index)\"\n                style=\"width: 200px\"\n              />\n            </div>\n          </FormItem>\n        </Col>\n        <Col span=\"24\" v-if=\"isBtn\" class=\"mt10\">\n          <Col span=\"8\" class=\"mr15\">\n            <FormItem label=\"规格名称：\">\n              <Input placeholder=\"请输入规格\" v-model=\"attrsName\" />\n            </FormItem>\n          </Col>\n          <Col span=\"8\" class=\"mr20\">\n            <FormItem label=\"规格值：\">\n              <Input v-model=\"attrsVal\" placeholder=\"请输入规格值\" />\n            </FormItem>\n          </Col>\n          <Col span=\"2\">\n            <Button type=\"primary\" @click=\"createAttrName\">确定</Button>\n          </Col>\n          <Col span=\"2\">\n            <Button @click=\"offAttrName\">取消</Button>\n          </Col>\n        </Col>\n        <Spin size=\"large\" fix v-if=\"spinShow\"></Spin>\n      </Row>\n      <Button type=\"primary\" icon=\"md-add\" @click=\"addBtn\" v-if=\"!isBtn\" class=\"ml95 mt10\">添加新规格</Button>\n    </Form>\n    <div slot=\"footer\">\n      <Button type=\"primary\" :loading=\"modal_loading\" @click=\"handleSubmit('formDynamic')\">确定</Button>\n    </div>\n  </Modal>\n</template>\n\n<script>\nimport { mapState } from 'vuex';\nimport { ruleAddApi, ruleInfoApi } from '@/api/product';\nexport default {\n  name: 'addAttr',\n  data() {\n    return {\n      spinShow: false,\n      modal_loading: false,\n      grid: {\n        xl: 3,\n        lg: 3,\n        md: 12,\n        sm: 24,\n        xs: 24,\n      },\n      modal: false,\n      index: 1,\n      rules: {\n        rule_name: [{ required: true, message: '请输入规格名称', trigger: 'blur' }],\n      },\n      formDynamic: {\n        rule_name: '',\n        spec: [],\n      },\n      attrsName: '',\n      attrsVal: '',\n      formDynamicNameData: [],\n      isBtn: false,\n      formDynamicName: [],\n      results: [],\n      result: [],\n      ids: 0,\n    };\n  },\n  computed: {},\n  methods: {\n    onCancel() {\n      this.ids = 0;\n      this.clear();\n    },\n    // 添加按钮\n    addBtn() {\n      this.isBtn = true;\n    },\n    // 详情\n    getIofo(row) {\n      this.spinShow = true;\n      this.ids = row.id;\n      ruleInfoApi(row.id)\n        .then((res) => {\n          this.formDynamic = res.data.info;\n          this.spinShow = false;\n        })\n        .catch((res) => {\n          this.spinShow = false;\n          this.$Message.error(res.msg);\n        });\n    },\n    // 提交\n    handleSubmit(name) {\n      this.$refs[name].validate((valid) => {\n        if (valid) {\n          if (this.formDynamic.spec.length === 0) {\n            return this.$Message.warning('请至少添加一条商品规格！');\n          }\n          this.modal_loading = true;\n          setTimeout(() => {\n            ruleAddApi(this.formDynamic, this.ids)\n              .then((res) => {\n                this.$Message.success(res.msg);\n                setTimeout(() => {\n                  this.modal = false;\n                  this.modal_loading = false;\n                }, 500);\n                setTimeout(() => {\n                  this.$emit('getList');\n                  this.clear();\n                }, 600);\n              })\n              .catch((res) => {\n                this.modal_loading = false;\n                this.$Message.error(res.msg);\n              });\n          }, 1200);\n        } else {\n          return false;\n        }\n      });\n    },\n    clear() {\n      this.$refs['formDynamic'].resetFields();\n      this.formDynamic.spec = [];\n      this.isBtn = false;\n      this.attrsName = '';\n      this.attrsVal = '';\n      this.ids = 0;\n    },\n    // 取消\n    offAttrName() {\n      this.isBtn = false;\n    },\n    // 删除\n    handleRemove(index) {\n      this.formDynamic.spec.splice(index, 1);\n    },\n    // 删除属性\n    handleRemove2(item, index) {\n      item.splice(index, 1);\n    },\n    // 添加规则名称\n    createAttrName() {\n      if (this.attrsName && this.attrsVal) {\n        let data = {\n          value: this.attrsName,\n          detail: [this.attrsVal],\n        };\n        this.formDynamic.spec.push(data);\n        var hash = {};\n        this.formDynamic.spec = this.formDynamic.spec.reduce(function (item, next) {\n          /* eslint-disable */\n          hash[next.value] ? '' : (hash[next.value] = true && item.push(next));\n          return item;\n        }, []);\n        this.attrsName = '';\n        this.attrsVal = '';\n        this.isBtn = false;\n      } else {\n        this.$Message.warning('请添加规格名称或规格值');\n      }\n    },\n    // 添加属性\n    createAttr(num, idx) {\n      if (num) {\n        this.formDynamic.spec[idx].detail.push(num);\n        var hash = {};\n        this.formDynamic.spec[idx].detail = this.formDynamic.spec[idx].detail.reduce(function (item, next) {\n          /* eslint-disable */\n          hash[next] ? '' : (hash[next] = true && item.push(next));\n          return item;\n        }, []);\n      } else {\n        this.$Message.warning('请添加属性');\n      }\n    },\n  },\n};\n</script>\n\n<style scoped lang=\"stylus\">\n.rulesBox {\n  display: flex;\n  align-items: center;\n  flex-wrap: wrap;\n}\n\n.attrFrom {\n  >>> .ivu-form-item {\n    margin-bottom: 0px !important;\n  }\n}\n</style>\n"]}]}