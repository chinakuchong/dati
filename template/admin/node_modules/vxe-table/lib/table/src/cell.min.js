"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=exports.Cell=void 0;var _xeUtils=_interopRequireDefault(require("xe-utils")),_conf=_interopRequireDefault(require("../../v-x-e-table/src/conf")),_vXETable=_interopRequireDefault(require("../../v-x-e-table")),_dom=_interopRequireDefault(require("../../tools/dom")),_utils=_interopRequireWildcard(require("../../tools/utils")),_util=require("./util"),_vn=require("../../tools/vn");function _getRequireWildcardCache(e){if("function"!=typeof WeakMap)return null;var r=new WeakMap,t=new WeakMap;return(_getRequireWildcardCache=function(e){return e?t:r})(e)}function _interopRequireWildcard(e,r){if(!r&&e&&e.__esModule)return e;if(null===e||"object"!==_typeof(e)&&"function"!=typeof e)return{default:e};r=_getRequireWildcardCache(r);if(r&&r.has(e))return r.get(e);var t,l,n={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(t in e)"default"!==t&&Object.prototype.hasOwnProperty.call(e,t)&&((l=o?Object.getOwnPropertyDescriptor(e,t):null)&&(l.get||l.set)?Object.defineProperty(n,t,l):n[t]=e[t]);return n.default=e,r&&r.set(e,n),n}function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function ownKeys(r,e){var t,l=Object.keys(r);return Object.getOwnPropertySymbols&&(t=Object.getOwnPropertySymbols(r),e&&(t=t.filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})),l.push.apply(l,t)),l}function _objectSpread(r){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(t),!0).forEach(function(e){_defineProperty(r,e,t[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach(function(e){Object.defineProperty(r,e,Object.getOwnPropertyDescriptor(t,e))})}return r}function _defineProperty(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function renderHelpIcon(e,r){var t=r.$table,l=r.column,l=l.titlePrefix||l.titleHelp;return l?[e("i",{class:["vxe-cell-help-icon",l.icon||_conf.default.icon.TABLE_HELP],on:{mouseenter:function(e){t.triggerHeaderHelpEvent(e,r)},mouseleave:function(e){t.handleTargetLeaveEvent(e)}}})]:[]}function renderTitleContent(e,r,t){var l=r.$table,n=r.column,o=n.type,i=n.showHeaderOverflow,a=l.showHeaderOverflow,d=l.tooltipOpts,c=d.showAll||d.enabled,i=_xeUtils.default.isUndefined(i)||_xeUtils.default.isNull(i)?a:i,s="title"===i,u=!0===i||"tooltip"===i,i={};return(s||u||c)&&(i.mouseenter=function(e){l._isResize||(s?_dom.default.updateCellTitle(e.currentTarget,n):(u||c)&&l.triggerHeaderTooltipEvent(e,r))}),(u||c)&&(i.mouseleave=function(e){l._isResize||(u||c)&&l.handleTargetLeaveEvent(e)}),["html"===o&&_xeUtils.default.isString(t)?e("span",{class:"vxe-cell--title",domProps:{innerHTML:t},on:i}):e("span",{class:"vxe-cell--title",on:i},t)]}function getFooterContent(e,r){var t=r.$table,l=r.column,n=r._columnIndex,o=r.items,i=l.slots,a=l.editRender,l=l.cellRender,l=a||l;if(i&&i.footer)return t.callSlot(i.footer,r,e);if(l){i=_vXETable.default.renderer.get(l.name);if(i&&i.renderFooter)return(0,_vn.getSlotVNs)(i.renderFooter.call(t,e,l,r))}return[_utils.default.formatText(o[n],1)]}function getDefaultCellLabel(e){var r=e.$table,t=e.row,e=e.column;return _utils.default.formatText(r.getCellLabel(t,e),1)}var Cell={createColumn:function(e,r){var t=r.type,l=r.sortable,n=r.remoteSort,o=r.filters,i=r.editRender,a=r.treeNode,d=e.editConfig,c=e.editOpts,s=e.checkboxOpts,u={renderHeader:this.renderDefaultHeader,renderCell:a?this.renderTreeCell:this.renderDefaultCell,renderFooter:this.renderDefaultFooter};switch(t){case"seq":u.renderHeader=this.renderSeqHeader,u.renderCell=a?this.renderTreeIndexCell:this.renderSeqCell;break;case"radio":u.renderHeader=this.renderRadioHeader,u.renderCell=a?this.renderTreeRadioCell:this.renderRadioCell;break;case"checkbox":u.renderHeader=this.renderCheckboxHeader,u.renderCell=s.checkField?a?this.renderTreeSelectionCellByProp:this.renderCheckboxCellByProp:a?this.renderTreeSelectionCell:this.renderCheckboxCell;break;case"expand":u.renderCell=this.renderExpandCell,u.renderData=this.renderExpandData;break;case"html":u.renderCell=a?this.renderTreeHTMLCell:this.renderHTMLCell,o&&(l||n)?u.renderHeader=this.renderSortAndFilterHeader:l||n?u.renderHeader=this.renderSortHeader:o&&(u.renderHeader=this.renderFilterHeader);break;default:d&&i?(u.renderHeader=this.renderEditHeader,u.renderCell="cell"===c.mode?a?this.renderTreeCellEdit:this.renderCellEdit:a?this.renderTreeRowEdit:this.renderRowEdit):o&&(l||n)?u.renderHeader=this.renderSortAndFilterHeader:l||n?u.renderHeader=this.renderSortHeader:o&&(u.renderHeader=this.renderFilterHeader)}return(0,_util.getColumnConfig)(e,r,u)},renderHeaderTitle:function(e,r){var t=r.$table,l=r.column,n=l.slots,o=l.editRender,i=l.cellRender,i=o||i;if(n&&n.header)return renderTitleContent(e,r,t.callSlot(n.header,r,e));if(i){n=_vXETable.default.renderer.get(i.name);if(n&&n.renderHeader)return(0,_vn.getSlotVNs)(renderTitleContent(e,r,n.renderHeader.call(t,e,i,r)))}return renderTitleContent(e,r,_utils.default.formatText(l.getTitle(),1))},renderDefaultHeader:function(e,r){return renderHelpIcon(e,r).concat(Cell.renderHeaderTitle(e,r))},renderDefaultCell:function(e,r){var t=r.$table,l=r.row,n=r.column,o=n.slots,i=n.editRender,a=n.cellRender,d=i||a;if(o&&o.default)return t.callSlot(o.default,r,e);if(d){a=i?"renderCell":"renderDefault",o=_vXETable.default.renderer.get(d.name);if(o&&o[a])return(0,_vn.getSlotVNs)(o[a].call(t,e,d,Object.assign({$type:i?"edit":"cell"},r)))}l=t.getCellLabel(l,n),n=i?i.placeholder:"";return[e("span",{class:"vxe-cell--label"},i&&(0,_utils.eqEmptyValue)(l)?[e("span",{class:"vxe-cell--placeholder"},_utils.default.formatText((0,_utils.getFuncText)(n),1))]:_utils.default.formatText(l,1))]},renderTreeCell:function(e,r){return Cell.renderTreeIcon(e,r,Cell.renderDefaultCell.call(this,e,r))},renderDefaultFooter:function(e,r){return[e("span",{class:"vxe-cell--item"},getFooterContent(e,r))]},renderTreeIcon:function(e,r,t){var l=r.$table,n=r.isHidden,o=l.treeOpts,i=l.treeExpandeds,a=l.treeLazyLoadeds,d=r.row,c=r.column,s=r.level,u=c.slots,f=o.children,C=o.hasChild,b=o.indent,p=o.lazy,_=o.trigger,h=o.iconLoaded,E=o.showIcon,v=o.iconOpen,x=o.iconClose,T=d[f],m=!1,c=!1,o=!1,f={};return u&&u.icon?l.callSlot(u.icon,r,e,t):(n||(c=-1<l.findRowIndexOf(i,d),p&&(o=-1<l.findRowIndexOf(a,d),m=d[C])),_&&"default"!==_||(f.click=function(e){return l.triggerTreeExpandEvent(e,r)}),[e("div",{class:["vxe-cell--tree-node",{"is--active":c}],style:{paddingLeft:"".concat(s*b,"px")}},[E&&(T&&T.length||m)?[e("div",{class:"vxe-tree--btn-wrapper",on:f},[e("i",{class:["vxe-tree--node-btn",o?h||_conf.default.icon.TABLE_TREE_LOADED:c?v||_conf.default.icon.TABLE_TREE_OPEN:x||_conf.default.icon.TABLE_TREE_CLOSE]})])]:null,e("div",{class:"vxe-tree-cell"},t)])])},renderSeqHeader:function(e,r){var t=r.$table,l=r.column,n=l.slots;return renderTitleContent(e,r,n&&n.header?t.callSlot(n.header,r,e):_utils.default.formatText(l.getTitle(),1))},renderSeqCell:function(e,r){var t=r.$table,l=r.column,n=t.treeConfig,o=t.seqOpts,l=l.slots;if(l&&l.default)return t.callSlot(l.default,r,e);l=r.seq,e=o.seqMethod;return[_utils.default.formatText(e?e(r):n?l:(o.startIndex||0)+l,1)]},renderTreeIndexCell:function(e,r){return Cell.renderTreeIcon(e,r,Cell.renderSeqCell(e,r))},renderRadioHeader:function(e,r){var t=r.$table,l=r.column,n=l.slots,o=n?n.header:null,n=n?n.title:null;return renderTitleContent(e,r,o?t.callSlot(o,r,e):[e("span",{class:"vxe-radio--label"},n?t.callSlot(n,r,e):_utils.default.formatText(l.getTitle(),1))])},renderRadioCell:function(e,r){var t,l=r.$table,n=r.column,o=r.isHidden,i=l.radioOpts,a=l.selectRow,d=n.slots,c=i.labelField,s=i.checkMethod,u=i.visibleMethod,n=r.row,i=d?d.default:null,d=d?d.radio:null,a=n===a,f=!u||u({row:n}),C=!!s;o||(t={click:function(e){!C&&f&&l.triggerRadioRowEvent(e,r)}},s&&(C=!s({row:n})));s=_objectSpread(_objectSpread({},r),{},{checked:a,disabled:C,visible:f});if(d)return l.callSlot(d,s,e);d=[];return f&&d.push(e("span",{class:["vxe-radio--icon",a?_conf.default.icon.TABLE_RADIO_CHECKED:_conf.default.icon.TABLE_RADIO_UNCHECKED]})),(i||c)&&d.push(e("span",{class:"vxe-radio--label"},i?l.callSlot(i,s,e):_xeUtils.default.get(n,c))),[e("span",{class:["vxe-cell--radio",{"is--checked":a,"is--disabled":C}],on:t},d)]},renderTreeRadioCell:function(e,r){return Cell.renderTreeIcon(e,r,Cell.renderRadioCell(e,r))},renderCheckboxHeader:function(e,r){var t,l=r.$table,n=r.column,o=r.isHidden,i=l.isAllSelected,a=l.isIndeterminate,d=l.isAllCheckboxDisabled,c=n.slots,s=c?c.header:null,u=c?c.title:null,c=l.checkboxOpts,n=n.getTitle();o||(t={click:function(e){d||l.triggerCheckAllEvent(e,!i)}});r=_objectSpread(_objectSpread({},r),{},{checked:i,disabled:d,indeterminate:a});return s?renderTitleContent(e,r,l.callSlot(s,r,e)):(c.checkStrictly?c.showHeader:!1!==c.showHeader)?renderTitleContent(e,r,[e("span",{class:["vxe-cell--checkbox",{"is--checked":i,"is--disabled":d,"is--indeterminate":a}],attrs:{title:_conf.default.i18n("vxe.table.allTitle")},on:t},[e("span",{class:["vxe-checkbox--icon",a?_conf.default.icon.TABLE_CHECKBOX_INDETERMINATE:i?_conf.default.icon.TABLE_CHECKBOX_CHECKED:_conf.default.icon.TABLE_CHECKBOX_UNCHECKED]})].concat(u||n?[e("span",{class:"vxe-checkbox--label"},u?l.callSlot(u,r,e):n)]:[]))]):renderTitleContent(e,r,[e("span",{class:"vxe-checkbox--label"},u?l.callSlot(u,r,e):n)])},renderCheckboxCell:function(e,r){var t,l=r.$table,n=r.row,o=r.column,i=r.isHidden,a=l.treeConfig,d=l.treeIndeterminates,c=l.selection,s=l.checkboxOpts,u=s.labelField,f=s.checkMethod,C=s.visibleMethod,b=o.slots,s=b?b.default:null,o=b?b.checkbox:null,b=!1,p=!1,_=!C||C({row:n}),h=!!f;i||(p=-1<l.findRowIndexOf(c,n),t={click:function(e){!h&&_&&l.triggerCheckRowEvent(e,r,!p)}},f&&(h=!f({row:n})),a&&(b=-1<l.findRowIndexOf(d,n)));d=_objectSpread(_objectSpread({},r),{},{checked:p,disabled:h,visible:_,indeterminate:b});if(o)return l.callSlot(o,d,e);o=[];return _&&o.push(e("span",{class:["vxe-checkbox--icon",b?_conf.default.icon.TABLE_CHECKBOX_INDETERMINATE:p?_conf.default.icon.TABLE_CHECKBOX_CHECKED:_conf.default.icon.TABLE_CHECKBOX_UNCHECKED]})),(s||u)&&o.push(e("span",{class:"vxe-checkbox--label"},s?l.callSlot(s,d,e):_xeUtils.default.get(n,u))),[e("span",{class:["vxe-cell--checkbox",{"is--checked":p,"is--disabled":h,"is--indeterminate":b}],on:t},o)]},renderTreeSelectionCell:function(e,r){return Cell.renderTreeIcon(e,r,Cell.renderCheckboxCell(e,r))},renderCheckboxCellByProp:function(e,r){var t,l=r.$table,n=r.row,o=r.column,i=r.isHidden,a=l.treeConfig,d=l.treeIndeterminates,c=l.checkboxOpts,s=c.labelField,u=c.checkField,f=c.halfField,C=c.checkMethod,b=c.visibleMethod,p=o.slots,c=p?p.default:null,o=p?p.checkbox:null,p=!1,_=!1,h=!b||b({row:n}),E=!!C;i||(_=_xeUtils.default.get(n,u),t={click:function(e){!E&&h&&l.triggerCheckRowEvent(e,r,!_)}},C&&(E=!C({row:n})),a&&(p=-1<l.findRowIndexOf(d,n)));d=_objectSpread(_objectSpread({},r),{},{checked:_,disabled:E,visible:h,indeterminate:p});if(o)return l.callSlot(o,d,e);o=[];return h&&o.push(e("span",{class:["vxe-checkbox--icon",p?_conf.default.icon.TABLE_CHECKBOX_INDETERMINATE:_?_conf.default.icon.TABLE_CHECKBOX_CHECKED:_conf.default.icon.TABLE_CHECKBOX_UNCHECKED]})),(c||s)&&o.push(e("span",{class:"vxe-checkbox--label"},c?l.callSlot(c,d,e):_xeUtils.default.get(n,s))),[e("span",{class:["vxe-cell--checkbox",{"is--checked":_,"is--disabled":E,"is--indeterminate":f&&!_?n[f]:p}],on:t},o)]},renderTreeSelectionCellByProp:function(e,r){return Cell.renderTreeIcon(e,r,Cell.renderCheckboxCellByProp(e,r))},renderExpandCell:function(e,r){var t=r.$table,l=r.isHidden,n=r.row,o=r.column,i=t.expandOpts,a=t.rowExpandeds,d=t.expandLazyLoadeds,c=i.lazy,s=i.labelField,u=i.iconLoaded,f=i.showIcon,C=i.iconOpen,b=i.iconClose,p=i.visibleMethod,_=o.slots,h=_?_.default:null,i=!1,o=!1;return _&&_.icon?t.callSlot(_.icon,r,e):(l||(i=-1<t.findRowIndexOf(a,r.row),c&&(o=-1<t.findRowIndexOf(d,n))),[!f||p&&!p(r)?null:e("span",{class:["vxe-table--expanded",{"is--active":i}],on:{click:function(e){t.triggerRowExpandEvent(e,r)}}},[e("i",{class:["vxe-table--expand-btn",o?u||_conf.default.icon.TABLE_EXPAND_LOADED:i?C||_conf.default.icon.TABLE_EXPAND_OPEN:b||_conf.default.icon.TABLE_EXPAND_CLOSE]})]),h||s?e("span",{class:"vxe-table--expand-label"},h?t.callSlot(h,r,e):_xeUtils.default.get(n,s)):null])},renderExpandData:function(e,r){var t=r.$table,l=r.column,n=l.slots,l=l.contentRender;if(n&&n.content)return t.callSlot(n.content,r,e);if(l){n=_vXETable.default.renderer.get(l.name);if(n&&n.renderExpand)return(0,_vn.getSlotVNs)(n.renderExpand.call(t,e,l,r))}return[]},renderHTMLCell:function(e,r){var t=r.$table,l=r.column.slots;return l&&l.default?t.callSlot(l.default,r,e):[e("span",{class:"vxe-cell--html",domProps:{innerHTML:getDefaultCellLabel(r)}})]},renderTreeHTMLCell:function(e,r){return Cell.renderTreeIcon(e,r,Cell.renderHTMLCell(e,r))},renderSortAndFilterHeader:function(e,r){return Cell.renderDefaultHeader(e,r).concat(Cell.renderSortIcon(e,r)).concat(Cell.renderFilterIcon(e,r))},renderSortHeader:function(e,r){return Cell.renderDefaultHeader(e,r).concat(Cell.renderSortIcon(e,r))},renderSortIcon:function(e,r){var t=r.$table,l=r.column,n=t.sortOpts,o=n.showIcon,r=n.iconAsc,n=n.iconDesc;return o?[e("span",{class:"vxe-cell--sort"},[e("i",{class:["vxe-sort--asc-btn",r||_conf.default.icon.TABLE_SORT_ASC,{"sort--active":"asc"===l.order}],attrs:{title:_conf.default.i18n("vxe.table.sortAsc")},on:{click:function(e){t.triggerSortEvent(e,l,"asc")}}}),e("i",{class:["vxe-sort--desc-btn",n||_conf.default.icon.TABLE_SORT_DESC,{"sort--active":"desc"===l.order}],attrs:{title:_conf.default.i18n("vxe.table.sortDesc")},on:{click:function(e){t.triggerSortEvent(e,l,"desc")}}})])]:[]},renderFilterHeader:function(e,r){return Cell.renderDefaultHeader(e,r).concat(Cell.renderFilterIcon(e,r))},renderFilterIcon:function(e,r){var t=r.$table,l=r.column,n=r.hasFilter,o=t.filterStore,i=t.filterOpts,a=i.showIcon,d=i.iconNone,i=i.iconMatch;return a?[e("span",{class:["vxe-cell--filter",{"is--active":o.visible&&o.column===l}]},[e("i",{class:["vxe-filter--btn",n?i||_conf.default.icon.TABLE_FILTER_MATCH:d||_conf.default.icon.TABLE_FILTER_NONE],attrs:{title:_conf.default.i18n("vxe.table.filter")},on:{click:function(e){t.triggerFilterEvent(e,r.column,r)}}})])]:[]},renderEditHeader:function(e,r){var t=r.$table,l=r.column,n=t.editConfig,o=t.editRules,i=t.editOpts,a=l.sortable,d=l.remoteSort,c=l.filters,s=l.editRender,t=!1;return!o||(l=_xeUtils.default.get(o,l.field))&&(t=l.some(function(e){return e.required})),((0,_utils.isEnableConf)(n)?[t&&i.showAsterisk?e("i",{class:"vxe-cell--required-icon"}):null,(0,_utils.isEnableConf)(s)&&i.showIcon?e("i",{class:["vxe-cell--edit-icon",i.icon||_conf.default.icon.TABLE_EDIT]}):null]:[]).concat(Cell.renderDefaultHeader(e,r)).concat(a||d?Cell.renderSortIcon(e,r):[]).concat(c?Cell.renderFilterIcon(e,r):[])},renderRowEdit:function(e,r){var t=r.$table,l=r.column.editRender,t=t.editStore.actived;return Cell.runRenderer(e,r,this,(0,_utils.isEnableConf)(l)&&t&&t.row===r.row)},renderTreeRowEdit:function(e,r){return Cell.renderTreeIcon(e,r,Cell.renderRowEdit(e,r))},renderCellEdit:function(e,r){var t=r.$table,l=r.column.editRender,t=t.editStore.actived;return Cell.runRenderer(e,r,this,(0,_utils.isEnableConf)(l)&&t&&t.row===r.row&&t.column===r.column)},renderTreeCellEdit:function(e,r){return Cell.renderTreeIcon(e,r,Cell.renderCellEdit(e,r))},runRenderer:function(e,r,t,l){var n=r.$table,o=r.column,i=o.slots,a=o.editRender,d=o.formatter,o=_vXETable.default.renderer.get(a.name);return l?i&&i.edit?n.callSlot(i.edit,r,e):o&&o.renderEdit?(0,_vn.getSlotVNs)(o.renderEdit.call(n,e,a,Object.assign({$type:"edit"},r))):[]:i&&i.default?n.callSlot(i.default,r,e):d?[e("span",{class:"vxe-cell--label"},[getDefaultCellLabel(r)])]:Cell.renderDefaultCell.call(t,e,r)}},_default=exports.Cell=Cell;exports.default=_default;